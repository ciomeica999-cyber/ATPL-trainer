<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ATPL MASTER v20</title>
<style>
:root{--primary:#007aff;--orange:#ff9f0a;--purple:#af52de;--bg:#f2f2f7;--card:#ffffff;--text:#000;--sub:#6c6c70;--border:#c6c6c8;--ok:#34c759;--no:#ff3b30;--shadow:0 4px 20px rgba(0,0,0,0.1)}
@media(prefers-color-scheme:dark){:root{--primary:#0a84ff;--bg:#000;--card:#1c1c1e;--text:#fff;--sub:#aeaeb2;--border:#38383a}}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);height:100dvh;display:flex;flex-direction:column;overflow:hidden}
header{height:50px;background:var(--card);border-bottom:0.5px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;font-weight:700;font-size:17px;padding-top:env(safe-area-inset-top);height:calc(50px + env(safe-area-inset-top));z-index:10}
.content{flex:1;overflow-y:auto;padding:20px 20px 150px 20px;-webkit-overflow-scrolling:touch}
.card{background:var(--card);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 2px 10px rgba(0,0,0,0.03)}
.mode-row{display:flex;gap:10px;margin-bottom:15px}
.mode-btn{flex:1;padding:15px;border-radius:12px;background:var(--card);border:2px solid transparent;text-align:center;font-weight:600;font-size:15px;box-shadow:0 2px 5px rgba(0,0,0,0.05);transition:0.2s;cursor:pointer}
.mode-btn.active-practice{border-color:var(--primary);background:rgba(0,122,255,0.1);color:var(--primary)}
.mode-btn.active-formulas{border-color:var(--purple);background:rgba(175,82,222,0.1);color:var(--purple)}
.mode-btn.active-exam{border-color:var(--orange);background:rgba(255,159,10,0.1);color:var(--orange)}
select{width:100%;padding:12px;border-radius:10px;background:var(--bg);color:var(--text);border:1px solid var(--border);margin-bottom:20px;font-size:16px}
.btn-start{width:100%;padding:16px;border-radius:14px;border:none;font-size:17px;font-weight:700;color:#fff;background:var(--primary);cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.2)}
.q-meta{display:flex;justify-content:space-between;font-size:12px;color:var(--sub);margin-bottom:10px;font-weight:600;text-transform:uppercase}
.q-text{font-size:18px;line-height:1.4;margin-bottom:25px;font-weight:600}
.option{width:100%;padding:18px;margin-bottom:12px;background:var(--bg);border:2px solid transparent;border-radius:14px;font-size:16px;color:var(--text);cursor:pointer;position:relative}
.option.correct{background:rgba(52,199,89,0.15);border-color:var(--ok)}
.option.wrong{background:rgba(255,59,48,0.15);border-color:var(--no)}
.option.selected{background:rgba(0,122,255,0.15);border-color:var(--primary)}
body.mode-formulas .option.selected{border-color:var(--purple);background:rgba(175,82,222,0.15)}
body.mode-exam .option.selected{border-color:var(--orange);background:rgba(255,159,10,0.15)}
.explanation{margin-top:20px;padding:15px;background:rgba(255,204,0,0.15);border-radius:12px;font-size:15px;line-height:1.4;border-left:4px solid #ffcc00;display:none}
.explanation.show{display:block}
.btn-deep{background:transparent;border:1px solid var(--text);color:var(--text);padding:8px 15px;border-radius:20px;font-size:13px;font-weight:600;margin-top:10px;cursor:pointer}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(5px);z-index:2000;display:none;align-items:flex-end}
.modal.open{display:flex;animation:up 0.3s ease-out}
.modal-card{background:var(--card);width:100%;max-height:85vh;border-radius:20px 20px 0 0;padding:25px;overflow-y:auto}
.nav{position:fixed;bottom:80px;left:20px;right:20px;height:60px;background:rgba(255,255,255,0.9);backdrop-filter:blur(20px);border-radius:30px;display:flex;align-items:center;padding:5px;box-shadow:var(--shadow);z-index:999;border:1px solid rgba(255,255,255,0.2)}
@media(prefers-color-scheme:dark){.nav{background:rgba(40,40,40,0.85)}}
.nav-btn{width:50px;height:50px;border-radius:25px;border:none;background:0 0;color:var(--text);font-size:20px;font-weight:700;cursor:pointer}
.nav-btn.primary{background:var(--primary);color:#fff;width:auto;flex:1;margin:0 5px;font-size:17px}
.hidden{display:none!important}
@keyframes up{from{transform:translateY(100%)}to{transform:translateY(0)}}
</style>
</head>
<body>
<header><div>ATPL <span style="color:var(--primary)">MASTER</span></div><div id="cnt" style="font-size:14px;color:var(--sub)">Ready</div></header>
<div id="view-home" class="content">
<div class="card">
<h2 style="margin-top:0">Training Setup</h2>
<div style="font-size:13px;color:var(--sub);margin-bottom:20px" id="dbInfo">Loading...</div>
<div class="mode-row"><div class="mode-btn active-practice" id="m-practice" onclick="app.setM('practice')">üéì Practice</div><div class="mode-btn" id="m-formulas" onclick="app.setM('formulas')">üìê Formulas</div></div>
<div class="mode-btn" id="m-exam" onclick="app.setM('exam')" style="margin-bottom:20px">‚è±Ô∏è Exam Mode</div>
<div id="dif"><select id="diff-sel"><option value="easy">Easy</option><option value="medium" selected>Medium</option><option value="hard">Hard</option></select></div>
<select id="num-sel"><option value="10">10 Questions</option><option value="20" selected>20 Questions</option><option value="50">50 Questions</option><option value="100">100 Questions</option></select>
<button class="btn-start" id="btnStart" onclick="app.start()">START SESSION</button>
<div style="text-align:center;margin-top:20px"><a href="#" onclick="app.wipe()" style="color:var(--sub);font-size:12px">Reset Data</a></div>
</div></div>
<div id="view-quiz" class="content hidden">
<div class="card"><div class="q-meta"><span id="qTop"></span><span id="qLvl" style="color:var(--primary)"></span></div>
<div class="q-text" id="qTxt"></div><div id="opts"></div>
<div id="expl" class="explanation"><span id="sh-exp"></span><br><button class="btn-deep" onclick="app.deep()">üìñ Deep Dive</button></div></div></div>
<div id="nav" class="nav hidden"><button class="nav-btn" onclick="app.back()">‚Üê</button><button class="nav-btn primary" id="act" onclick="app.next()">Next</button><button class="nav-btn" onclick="app.quit()">‚úï</button></div>
<div class="modal" id="mod" onclick="app.close(event)"><div class="modal-card"><h2 style="color:var(--primary)">Deep Dive</h2><div id="dp-txt" style="line-height:1.6"></div><button class="btn-start" style="margin-top:20px" onclick="app.close(null)">Close</button></div></div>
<div id="view-res" class="content hidden" style="text-align:center"><div class="card"><h2>Results</h2><div style="font-size:50px;font-weight:800;margin:30px 0;color:var(--primary)" id="score"></div><button class="btn-start" onclick="location.reload()">Home</button></div></div>
<script>
const DB = [
    // --- CH1: ATMOSPHERE & DEFINITIONS ---
    { id: "A01", topic: "Atmosphere", level: "easy", q: "The International Standard Atmosphere (ISA) assumes a MSL pressure of:", options: ["1013.25 hPa", "1000 hPa", "29.92 psi", "760 mb"], ans: 0, exp: "Standard datum.", longExp: "The baseline pressure is 1013.25 hectopascals (hPa) or 29.92 inches of mercury (inHg)." },
    { id: "A02", topic: "Atmosphere", level: "medium", q: "In the ISA, temperature decreases up to:", options: ["11 km (36,090 ft)", "20 km", "30,000 ft", "The poles"], ans: 0, exp: "Tropopause height.", longExp: "Temperature falls at 1.98¬∞C/1000ft until the Tropopause at 11km, then remains constant at -56.5¬∞C." },
    { id: "A03", topic: "Atmosphere", level: "hard", q: "Density Altitude is high when:", options: ["Pressure is low and Temp is high", "Pressure is high and Temp is low", "Air is dry", "At sea level"], ans: 0, exp: "Hot and High.", longExp: "Low pressure (high altitude) and High Temperature both reduce air density. This creates a high Density Altitude." },
    { id: "A04", topic: "Atmosphere", level: "medium", q: "Humidity's effect on Lift:", options: ["Reduces lift (lower density)", "Increases lift", "No effect", "Increases drag only"], ans: 0, exp: "Water vapor is light.", longExp: "Humid air is less dense than dry air because H2O molecules are lighter than N2/O2. Less density means less lift." },
    { id: "A05", topic: "Definitions", level: "easy", q: "Dynamic Pressure (q) is calculated as:", options: ["1/2 rho V¬≤", "rho V", "Pt - q", "Mass x Accel"], ans: 0, exp: "Kinetic energy of air.", longExp: "It represents the impact energy of the air. Dependent on density (rho) and velocity squared." },
    { id: "A06", topic: "Definitions", level: "medium", q: "Viscosity is:", options: ["Resistance to flow/shear", "Density", "Pressure", "Temperature"], ans: 0, exp: "Stickiness.", longExp: "Viscosity is the internal friction of a fluid. Air is viscous, which causes skin friction drag and boundary layers." },
    { id: "A07", topic: "Atmosphere", level: "hard", q: "Pressure Altitude is:", options: ["Indicated alt with 1013 set", "True Altitude", "Height AGL", "Density Alt"], ans: 0, exp: "Flight Levels.", longExp: "Pressure Altitude is the vertical distance from the 1013.25 hPa datum, regardless of actual pressure." },
    { id: "A08", topic: "Definitions", level: "medium", q: "Static Pressure acts:", options: ["In all directions equally", "Only downwards", "Only moving", "Perpendicular to flow"], ans: 0, exp: "Ambient.", longExp: "Static pressure is the potential energy of the air mass, acting equally in all directions." },
    { id: "A09", topic: "Atmosphere", level: "hard", q: "QNH vs QFE:", options: ["QNH = Altitude AMSL, QFE = Height", "QNH = Height, QFE = Altitude", "Both are same", "QFE is for FL"], ans: 0, exp: "Altimeter settings.", longExp: "QNH gives altitude above sea level. QFE gives height above the airfield datum (reads zero on runway)." },
    { id: "A10", topic: "Definitions", level: "easy", q: "Newtons Laws: Action = Reaction is:", options: ["3rd Law", "1st Law", "2nd Law", "4th Law"], ans: 0, exp: "Thrust/Drag.", longExp: "For every action there is an equal and opposite reaction. Explains thrust and lift generation." },

    // --- CH2: BASIC AERODYNAMICS ---
    { id: "B01", topic: "Basic Aero", level: "medium", q: "Bernoulli: If velocity increases...", options: ["Static pressure decreases", "Static pressure increases", "Total pressure increases", "Density increases"], ans: 0, exp: "Conservation of energy.", longExp: "Total Pressure = Static + Dynamic. If Dynamic (velocity) goes up, Static MUST go down." },
    { id: "B02", topic: "Basic Aero", level: "easy", q: "Equation of Continuity:", options: ["A1 V1 = A2 V2", "F = ma", "L = W", "P = Q"], ans: 0, exp: "Mass flow.", longExp: "Air passing through a venturi speeds up as the area gets smaller to maintain mass flow." },
    { id: "B03", topic: "Basic Aero", level: "medium", q: "Stagnation Point:", options: ["Air velocity is zero", "Max velocity", "Min pressure", "Separation"], ans: 0, exp: "Impact.", longExp: "The point on the leading edge where airflow separates to go over/under. Velocity is zero, Pressure is max." },
    { id: "B04", topic: "Basic Aero", level: "hard", q: "Streamline flow is:", options: ["Laminar/Smooth layers", "Turbulent", "Separated", "Rotational"], ans: 0, exp: "Orderly.", longExp: "Particles follow a smooth path without crossing. Opposite of turbulent flow." },
    { id: "B05", topic: "Basic Aero", level: "medium", q: "Venturi Effect:", options: ["Velocity up, Pressure down", "Velocity down, Pressure up", "Temp up", "Density up"], ans: 0, exp: "Throat.", longExp: "As air flows through a constriction, it accelerates and pressure drops (Bernoulli)." },
    { id: "B06", topic: "Basic Aero", level: "hard", q: "True Airspeed (TAS) vs IAS at altitude:", options: ["TAS > IAS", "TAS < IAS", "TAS = IAS", "Zero"], ans: 0, exp: "Density error.", longExp: "ASI measures dynamic pressure. As density drops with altitude, you need more TAS to get the same IAS reading." },
    { id: "B07", topic: "Basic Aero", level: "medium", q: "Relative Airflow (RAF):", options: ["Parallel/Opposite to flight path", "With flight path", "Vertical", "Horizontal"], ans: 0, exp: "Vector.", longExp: "RAF is always equal and opposite to the velocity vector of the aircraft center of gravity." },
    
    // --- CH3: LIFT ---
    { id: "L01", topic: "Lift", level: "medium", q: "Lift acts:", options: ["Perpendicular to RAF", "Vertical to horizon", "Opposite weight", "Upwards"], ans: 0, exp: "Definition.", longExp: "Aerodynamic Lift is defined as the force component perpendicular to the Relative Airflow." },
    { id: "L02", topic: "Lift", level: "hard", q: "CP movement on Symmetrical Airfoil:", options: ["Negligible movement", "Moves forward with AoA", "Moves aft", "Erratic"], ans: 0, exp: "Stable.", longExp: "On a symmetrical airfoil, the pressure distribution changes evenly, so the CP stays roughly at 25% chord." },
    { id: "L03", topic: "Lift", level: "medium", q: "Camber:", options: ["Curvature of the wing", "Thickness", "Span", "Angle"], ans: 0, exp: "Shape.", longExp: "Mean Camber Line is the line equidistant between upper and lower surfaces. Camber produces lift at 0 AoA." },
    { id: "L04", topic: "Lift", level: "hard", q: "Aerodynamic Center (AC):", options: ["Pitching moment constant", "Lift acts here", "Drag acts here", "CG"], ans: 0, exp: "25% Chord.", longExp: "The point where the pitching moment coefficient (Cm) does not vary with Angle of Attack." },
    { id: "L05", topic: "Lift", level: "medium", q: "Aspect Ratio formula:", options: ["Span¬≤ / Area", "Span / Area", "Chord / Span", "Thickness / Chord"], ans: 0, exp: "Slenderness.", longExp: "AR = b¬≤ / S. High AR reduces induced drag (gliders)." },
    { id: "L06", topic: "Lift", level: "hard", q: "Washout (Twist):", options: ["Root AoA > Tip AoA", "Tip AoA > Root", "No twist", "Dihedral"], ans: 0, exp: "Stall safety.", longExp: "Ensures the root stalls before the tip, keeping ailerons effective at the stall." },
    { id: "L07", topic: "Lift", level: "easy", q: "Lift Formula:", options: ["L = 1/2 rho V¬≤ S CL", "L = W", "L = D", "L = ma"], ans: 0, exp: "The big one.", longExp: "Shows Lift depends on Density, Velocity squared, Surface Area, and Lift Coefficient." },
    { id: "L08", topic: "Lift", level: "medium", q: "Angle of Attack:", options: ["Chord line vs RAF", "Chord vs Horizon", "Pitch angle", "Incidence"], ans: 0, exp: "Alpha.", longExp: "The angle between the Chord Line of the wing and the Relative Airflow vector." },
    { id: "L09", topic: "Lift", level: "medium", q: "Angle of Incidence:", options: ["Chord line vs Longitudinal Axis", "AoA", "Pitch", "Bank"], ans: 0, exp: "Rigging angle.", longExp: "The fixed angle at which the wing is attached to the fuselage." },
    { id: "L10", topic: "Lift", level: "hard", q: "Ground Effect:", options: ["Increases Lift, Decreases Drag", "Decreases Lift", "Increases Drag", "No effect"], ans: 0, exp: "Cushion.", longExp: "Blocks wingtip vortices, reducing Induced Drag and increasing effective Angle of Attack." },

    // --- CH4: DRAG ---
    { id: "D01", topic: "Drag", level: "hard", q: "Induced Drag relationship to speed:", options: ["1 / V¬≤", "V¬≤", "Linear", "Constant"], ans: 0, exp: "Drops with speed.", longExp: "Induced drag is a byproduct of lift (vortices). High speed = Low AoA = Weak vortices = Low Induced Drag." },
    { id: "D02", topic: "Drag", level: "medium", q: "Parasite Drag relationship to speed:", options: ["V¬≤", "1 / V¬≤", "Linear", "Constant"], ans: 0, exp: "Increases squared.", longExp: "Air resistance (Form, Friction, Interference) gets much stronger as you go faster." },
    { id: "D03", topic: "Drag", level: "medium", q: "Vmd (Min Drag Speed):", options: ["Where Induced = Parasite", "Stall speed", "Max speed", "Zero"], ans: 0, exp: "Best Glide.", longExp: "The bottom of the total drag curve. Gives max Lift/Drag ratio." },
    { id: "D04", topic: "Drag", level: "hard", q: "Skin Friction is increased by:", options: ["Rough surfaces / Dirt", "Polishing", "Laminar flow", "Altitude"], ans: 0, exp: "Turbulent boundary layer.", longExp: "Roughness trips the boundary layer into turbulence earlier, increasing skin friction." },
    { id: "D05", topic: "Drag", level: "medium", q: "Interference Drag:", options: ["Mixing of airflows at junctions", "Wingtip vortices", "Shape drag", "Wave drag"], ans: 0, exp: "Wing roots.", longExp: "Caused by eddies where components join (e.g., wing/fuselage). Reduced by fairings (fillets)." },
    { id: "D06", topic: "Drag", level: "hard", q: "Induced Drag is reduced by:", options: ["High Aspect Ratio / Winglets", "Low Aspect Ratio", "Speed Brakes", "Roughness"], ans: 0, exp: "Efficiency.", longExp: "Long wings or winglets reduce the strength of tip vortices." },
    { id: "D07", topic: "Drag", level: "medium", q: "Total Drag Curve shape:", options: ["U-shaped", "Linear", "Exponential", "Flat"], ans: 0, exp: "Bucket.", longExp: "Sum of decreasing Induced and increasing Parasite drag." },
    { id: "D08", topic: "Drag", level: "hard", q: "Effect of Weight on Induced Drag:", options: ["Increases", "Decreases", "None", "Varies"], ans: 0, exp: "More lift needed.", longExp: "Heavier plane needs more lift. More lift = stronger vortices = more Induced Drag." },
    { id: "D09", topic: "Drag", level: "medium", q: "Form Drag:", options: ["Pressure drag due to separation", "Friction", "Lift", "Vortices"], ans: 0, exp: "Wake.", longExp: "Caused by the pressure difference between the front (high) and rear (low/wake) of an object." },
    { id: "D10", topic: "Drag", level: "hard", q: "Speed stability below Vmd:", options: ["Unstable (Reversed Command)", "Stable", "Neutral", "Safe"], ans: 0, exp: "Drag rises as you slow.", longExp: "Below Vmd, if you slow down, drag increases, causing you to slow further. Need power to fix." },

    // --- CH5: STALLING ---
    { id: "S01", topic: "Stalling", level: "easy", q: "Stall is caused by:", options: ["Exceeding Critical AoA", "Low speed", "Heavy weight", "Back CG"], ans: 0, exp: "Separation.", longExp: "The ONLY cause is AoA. Can happen at any speed." },
    { id: "S02", topic: "Stalling", level: "hard", q: "Stall speed in 60¬∞ bank:", options: ["Increases by 41%", "Doubles", "No change", "Decreases"], ans: 0, exp: "Sqrt(2).", longExp: "Load factor is 2g. Vs increases by square root of 2 (1.41)." },
    { id: "S03", topic: "Stalling", level: "medium", q: "Stall warning activates:", options: ["5-10% or 5-10kts before stall", "At stall", "After stall", "During recovery"], ans: 0, exp: "Safety margin.", longExp: "Must give pilot time to react. Horn, light, or stick shaker." },
    { id: "S04", topic: "Stalling", level: "hard", q: "Forward CG effect on Stall Speed:", options: ["Increases Vs", "Decreases Vs", "None", "Prevents stall"], ans: 0, exp: "Tail load.", longExp: "Tail must push down harder. Wings must lift Weight + Tail force. Higher load = Higher Vs." },
    { id: "S05", topic: "Stalling", level: "medium", q: "Wing Drop at stall caused by:", options: ["Asymmetric stall", "Rudder", "Engine torque", "Flaps"], ans: 0, exp: "One wing stalls first.", longExp: "If one wing exceeds critical alpha before the other, it drops (rolls). Do not use ailerons to pick it up!" },
    { id: "S06", topic: "Stalling", level: "hard", q: "Deep Stall (Super Stall):", options: ["Wake blankets the tail", "Spin", "Spiral", "High speed"], ans: 0, exp: "T-tail hazard.", longExp: "Main wing wake covers the elevator. Pitch control is lost. Typical of T-tail aircraft." },
    { id: "S07", topic: "Stalling", level: "medium", q: "Stall Strip:", options: ["Sharp edge on LE to force root stall", "Anti-ice", "Drag device", "Lift device"], ans: 0, exp: "Controlled separation.", longExp: "Ensures the root stalls before the tip to keep ailerons effective." },
    { id: "S08", topic: "Stalling", level: "hard", q: "Vs1g definition:", options: ["Speed where lift = weight at stall", "Min speed", "Max speed", "Cruise"], ans: 0, exp: "Aerodynamic stall.", longExp: "Usually slightly higher than the certified min speed (Vmin) used in manuals." },
    { id: "S09", topic: "Stalling", level: "medium", q: "Recovery from stall:", options: ["Decrease AoA (Stick fwd)", "Power max, Stick back", "Rudder", "Ailerons"], ans: 0, exp: "Break the stall.", longExp: "Primary action is to reduce Angle of Attack. Power helps reduce height loss." },
    { id: "S10", topic: "Stalling", level: "hard", q: "Spin is:", options: ["Autorotation in aggravated stall", "Spiral dive", "Steep turn", "Roll"], ans: 0, exp: "Stall + Yaw.", longExp: "One wing is more stalled than the other, creating drag that drives the rotation." },

    // --- CH6: HIGH LIFT DEVICES ---
    { id: "H01", topic: "High Lift", level: "medium", q: "Flaps increase:", options: ["Camber and CLmax", "Stability", "Critical AoA", "Speed"], ans: 0, exp: "Lift curve shifts up.", longExp: "By increasing camber, flaps allow the wing to produce more lift at the same speed." },
    { id: "H02", topic: "High Lift", level: "medium", q: "Drag with Flaps:", options: ["Increases (Parasite + Induced)", "Decreases", "Unchanged", "Induced only"], ans: 0, exp: "Draggy.", longExp: "Flaps create huge form drag and induced drag. Useful for steep approaches." },
    { id: "H03", topic: "High Lift", level: "hard", q: "Slats purpose:", options: ["Re-energize boundary layer", "Increase camber", "Increase drag", "Brake"], ans: 0, exp: "Slot effect.", longExp: "Allow high pressure air from below to speed up air on top, delaying separation. Increases Critical Alpha." },
    { id: "H04", topic: "High Lift", level: "medium", q: "Fowler Flaps:", options: ["Move back and down (Area + Camber)", "Down only", "LE device", "Split"], ans: 0, exp: "Most efficient.", longExp: "Increase wing area AND camber. provide the biggest lift increase." },
    { id: "H05", topic: "High Lift", level: "hard", q: "Krueger Flaps:", options: ["Leading Edge device", "Trailing edge", "Spoiler", "Tab"], ans: 0, exp: "Hinged panel.", longExp: "Flap that folds out from the leading edge under-surface. Increases camber." },
    { id: "H06", topic: "High Lift", level: "medium", q: "Effect of Flaps on Trim:", options: ["Pitch change (usually nose down)", "No change", "Roll", "Yaw"], ans: 0, exp: "CP moves.", longExp: "Flaps move the CP aft, creating a nose-down pitching moment (on most high wing aircraft)." },
    { id: "H07", topic: "High Lift", level: "hard", q: "Slot:", options: ["Fixed gap behind LE", "Movable", "Trailing edge", "Spoiler"], ans: 0, exp: "Always open.", longExp: "A fixed slat. Improves high alpha handling but creates drag at cruise." },
    { id: "H08", topic: "High Lift", level: "medium", q: "Spoiler vs Flap:", options: ["Spoiler destroys lift, Flap creates it", "Same thing", "Spoiler is for takeoff", "None"], ans: 0, exp: "Brakes.", longExp: "Spoilers (Speedbrakes) dump lift and add drag. Flaps add lift and drag." },
    { id: "H09", topic: "High Lift", level: "hard", q: "CLmax with Slats:", options: ["Increases significantly", "Decreases", "Same", "Zero"], ans: 0, exp: "Higher stall angle.", longExp: "Can reach 20-25 degrees AoA without stalling." },
    { id: "H10", topic: "High Lift", level: "medium", q: "Takeoff Flap setting:", options: ["Intermediate (Lift > Drag)", "Full (Max Drag)", "Zero", "Negative"], ans: 0, exp: "Compromise.", longExp: "Enough lift to lower unstick speed, but not enough drag to kill climb performance." },
    
    // --- CH8: STABILITY ---
    { id: "ST01", topic: "Stability", level: "easy", q: "Static Stability:", options: ["Initial tendency to return", "Oscillation", "Time history", "Control force"], ans: 0, exp: "Start.", longExp: "Does it try to come back? Yes = Stable. No = Unstable." },
    { id: "ST02", topic: "Stability", level: "medium", q: "Dynamic Stability:", options: ["Motion over time", "Initial tendency", "Stick force", "CG"], ans: 0, exp: "Damping.", longExp: "Does the oscillation dampen out? (Positive Dynamic Stability)." },
    { id: "ST03", topic: "Stability", level: "medium", q: "Longitudinal Stability:", options: ["Pitch (CG vs Neutral Point)", "Roll", "Yaw", "Speed"], ans: 0, exp: "Tailplane.", longExp: "Depends on CG position relative to the Aerodynamic Center." },
    { id: "ST04", topic: "Stability", level: "hard", q: "Neutral Point:", options: ["Aero Center of whole aircraft", "CG limit", "CP", "Stall"], ans: 0, exp: "Limit.", longExp: "If CG is at Neutral Point, stability is neutral. CG must be forward of this." },
    { id: "ST05", topic: "Stability", level: "hard", q: "Aft CG effect:", options: ["Unstable / Light stick forces", "Stable / Heavy stick", "High Drag", "High Stall Speed"], ans: 0, exp: "Dangerous.", longExp: "Short lever arm to tail. Hard to recover from stall. Very sensitive controls." },
    { id: "ST06", topic: "Stability", level: "medium", q: "Lateral Stability:", options: ["Roll stability (Dihedral)", "Pitch", "Yaw", "Speed"], ans: 0, exp: "Wings Level.", longExp: "Tendency to return to wings level after a disturbance." },
    { id: "ST07", topic: "Stability", level: "hard", q: "Dutch Roll:", options: ["Strong Lat / Weak Dir Stability", "Weak Lat / Strong Dir", "Fwd CG", "Stall"], ans: 0, exp: "Oscillation.", longExp: "Aircraft wags tail and rolls. Caused by sweepback or excessive dihedral." },
    { id: "ST08", topic: "Stability", level: "hard", q: "Spiral Dive:", options: ["Weak Lat / Strong Dir Stability", "Dutch Roll", "Spin", "Stall"], ans: 0, exp: "Tightening turn.", longExp: "Aircraft banks, slips, corrects yaw but stays banked, speeding up into a dive." },
    { id: "ST09", topic: "Stability", level: "medium", q: "Directional Stability:", options: ["Fin / Rudder (Yaw)", "Wing", "Elevator", "CG"], ans: 0, exp: "Weathercock.", longExp: "Tendency to point into the relative wind. Provided by the Vertical Fin." },
    { id: "ST10", topic: "Stability", level: "hard", q: "Stick Force per G:", options: ["Manoeuvre Stability", "Static", "Dynamic", "Speed"], ans: 0, exp: "Feel.", longExp: "How heavy the stick gets when pulling Gs. Forward CG = Heavy. Aft CG = Light." },

    // --- CH9: CONTROLS ---
    { id: "C01", topic: "Controls", level: "medium", q: "Adverse Yaw:", options: ["Yaw opposite to turn", "Yaw into turn", "Roll", "Pitch"], ans: 0, exp: "Drag difference.", longExp: "Up-going wing (outside of turn) has more Lift/Induced Drag, pulling nose outside." },
    { id: "C02", topic: "Controls", level: "hard", q: "Frise Ailerons:", options: ["Up aileron projects LE to drag", "Down aileron drags", "Both equal", "Hydraulic"], ans: 0, exp: "Counter adverse yaw.", longExp: "The nose of the up-going aileron sticks out into the airflow to create drag on the inside wing." },
    { id: "C03", topic: "Controls", level: "medium", q: "Differential Ailerons:", options: ["Up moves more than down", "Down moves more", "Equal", "None"], ans: 0, exp: "Reduce drag on up-wing.", longExp: "The down-going wing (high lift) moves less to minimize drag increase." },
    { id: "C04", topic: "Controls", level: "hard", q: "Mass Balance:", options: ["Weights fwd of hinge", "Weights aft", "Aerodynamic", "Trim"], ans: 0, exp: "Flutter prevention.", longExp: "Moves the CG of the control surface onto the hinge line to stop inertial flutter." },
    { id: "C05", topic: "Controls", level: "medium", q: "Aerodynamic Balance (Horn):", options: ["Area fwd of hinge helps move surface", "Weight", "Trim", "Tab"], ans: 0, exp: "Reduces stick force.", longExp: "The air pushes on the horn (forward of hinge) helping the pilot turn the surface." },
    { id: "C06", topic: "Controls", level: "hard", q: "Balance Tab:", options: ["Moves opposite to surface", "Moves same way", "Fixed", "Trim"], ans: 0, exp: "Assist.", longExp: "Aerodynamic force on the tab helps move the heavy main surface." },
    { id: "C07", topic: "Controls", level: "hard", q: "Anti-Balance Tab:", options: ["Moves same way as surface", "Opposite", "Fixed", "Trim"], ans: 0, exp: "Heavier feel.", longExp: "Increases stick force (e.g., on all-moving tailplanes) to prevent over-control." },
    { id: "C08", topic: "Controls", level: "medium", q: "Trim Tab:", options: ["Relieves stick force", "Moves surface", "Brakes", "Dumps lift"], ans: 0, exp: "Hands off.", longExp: "Holds the control surface in the desired position so pilot doesn't have to." },
    { id: "C09", topic: "Controls", level: "medium", q: "Servo Tab:", options: ["Pilot moves tab, tab moves surface", "Pilot moves surface", "Trim", "Balance"], ans: 0, exp: "No direct link.", longExp: "Used on large aircraft. Pilot only moves the small tab; aero forces on tab move the main surface." },
    { id: "C10", topic: "Controls", level: "hard", q: "Ventral Fin:", options: ["Improves Directional Stability", "Lateral", "Lift", "Drag"], ans: 0, exp: "High AoA.", longExp: "Extra fin area below fuselage. Works even when main tail is blanketed at high alpha." },
// --- CH10: MANOEUVRES & LIMITS (Intro) ---
    { id: "M01", topic: "Limits", level: "medium", q: "Load Factor (n) definition:", options: ["Lift / Weight", "Thrust / Drag", "Weight / Mass", "Lift / Drag"], ans: 0, exp: "G-force.", longExp: "Ratio of the aerodynamic force (Lift) to the Weight." },
    { id: "M02", topic: "Limits", level: "hard", q: "Load factor in 60 deg turn:", options: ["2.0g", "1.4g", "1.0g", "4.0g"], ans: 0, exp: "1/cos(60).", longExp: "Cos(60) is 0.5. 1/0.5 = 2. You feel twice your weight." },
    { id: "M03", topic: "Limits", level: "hard", q: "Va (Manoeuvring Speed):", options: ["Max speed for full control deflection", "Stall", "Cruise", "Never exceed"], ans: 0, exp: "Structural protection.", longExp: "At speeds above Va, full control deflection can break the aircraft. Below Va, the wing stalls before breaking." },
    { id: "M04", topic: "Limits", level: "medium", q: "Vne:", options: ["Never Exceed Speed", "Normal", "Flap", "Gear"], ans: 0, exp: "Red line.", longExp: "Max speed permitted. Risk of flutter or structural failure." },
    { id: "M05", topic: "Limits", level: "medium", q: "V-n Diagram (Envelope):", options: ["Plots Load Factor vs Speed", "Altitude vs Speed", "Drag vs Speed", "Thrust"], ans: 0, exp: "Flight envelope.", longExp: "Shows the safe operating limits of g-load and airspeed." },
    
    // --- MIXED BAG (Ch 1-10 Revision) ---
    { id: "R01", topic: "Lift", level: "hard", q: "Geometric Twist is:", options: ["Washout", "Camber", "Dihedral", "Sweep"], ans: 0, exp: "Root vs Tip.", longExp: "Physical twisting of the wing to change incidence." },
    { id: "R02", topic: "Drag", level: "medium", q: "L/D Ratio Max:", options: ["Best Glide Angle", "Max Speed", "Min Speed", "Stall"], ans: 0, exp: "Efficiency.", longExp: "Occurs at Vmd (4 deg AoA)." },
    { id: "R03", topic: "Atmosphere", level: "medium", q: "ISA Sea Level Temp:", options: ["15¬∞C", "0¬∞C", "25¬∞C", "-5¬∞C"], ans: 0, exp: "Standard.", longExp: "288 Kelvin or 15 Celsius." },
    { id: "R04", topic: "Stability", level: "hard", q: "Phugoid:", options: ["Long period pitch oscillation", "Short period", "Dutch Roll", "Spin"], ans: 0, exp: "Speed/Height trade.", longExp: "Slow exchange of potential and kinetic energy. Aircraft goes up/slow, down/fast." },
    { id: "R05", topic: "Controls", level: "medium", q: "Spring Tab:", options: ["Assists at high speed", "Low speed", "Trim", "Anti-balance"], ans: 0, exp: "Variable assist.", longExp: "Spring compresses at high speed to move the tab." },
    { id: "R06", topic: "Stalling", level: "medium", q: "Stick Shaker activates:", options: ["Artificial stall warning", "Natural buffet", "Spin", "Overspeed"], ans: 0, exp: "Motor.", longExp: "Vibrates the stick to simulate natural buffet if the aircraft doesn't produce it." },
    { id: "R07", topic: "Lift", level: "hard", q: "Symmetrical Airfoil Lift at 0 AoA:", options: ["Zero", "Positive", "Negative", "Drag"], ans: 0, exp: "Symmetry.", longExp: "No pressure difference." },
    { id: "R08", topic: "Drag", level: "medium", q: "Fillets:", options: ["Reduce Interference Drag", "Increase Lift", "Brakes", "Cooling"], ans: 0, exp: "Fairings.", longExp: "Smooth the airflow at the wing root." },
    { id: "R09", topic: "Atmosphere", level: "hard", q: "Altimeter in cold air:", options: ["Overreads (Danger)", "Underreads", "Correct", "Zero"], ans: 0, exp: "Look out below.", longExp: "Air column shrinks. You are lower than indicated." },
    { id: "R10", topic: "Basic Aero", level: "medium", q: "Dynamic Pressure increases with:", options: ["Speed squared", "Height", "Temp", "Viscosity"], ans: 0, exp: "V¬≤.", longExp: "q = 1/2 rho V¬≤." },

    // --- FORMULAS (Pure PoF Math) ---
    { id: "F01", topic: "Formulas", level: "medium", q: "Load Factor (n):", options: ["1 / cos(phi)", "sin(phi)", "tan(phi)", "cos(phi)"], ans: 0, exp: "Bank angle.", longExp: "n = Lift/Weight. In a turn, L = W/cos(bank)." },
    { id: "F02", topic: "Formulas", level: "hard", q: "Vs new vs Weight:", options: ["Vs2 = Vs1 * sqrt(W2/W1)", "Linear", "Square", "None"], ans: 0, exp: "Root relationship.", longExp: "Stall speed varies with the square root of the weight change." },
    { id: "F03", topic: "Formulas", level: "hard", q: "Turn Radius:", options: ["V¬≤ / (g tan phi)", "V / tan phi", "V g", "V¬≤"], ans: 0, exp: "V squared.", longExp: "Radius increases rapidly with speed." },
    { id: "F04", topic: "Formulas", level: "hard", q: "Rate of Turn:", options: ["g tan phi / V", "V / R", "V tan phi", "Const"], ans: 0, exp: "Inverse V.", longExp: "Faster speed = Slower rate (deg/sec)." },
    { id: "F05", topic: "Formulas", level: "medium", q: "Dynamic Pressure (q):", options: ["1/2 rho V¬≤", "rho V", "Pt", "V¬≤"], ans: 0, exp: "Kinetic.", longExp: "Energy of the air motion per unit volume." },
    { id: "F06", topic: "Formulas", level: "medium", q: "Lift Coefficient:", options: ["L / (q S)", "L q S", "D/L", "q/S"], ans: 0, exp: "Efficiency.", longExp: "CL is the dimensionless lift capability." },
    { id: "F07", topic: "Formulas", level: "hard", q: "Glide Ratio:", options: ["Lift / Drag", "Thrust / Drag", "Weight / Lift", "Speed / Fuel"], ans: 0, exp: "Efficiency.", longExp: "Distance traveled per unit height lost." },
    { id: "F08", topic: "Formulas", level: "hard", q: "Climb Gradient:", options: ["(T-D)/W", "L/W", "T/W", "D/L"], ans: 0, exp: "Excess Thrust.", longExp: "Angle of climb depends on Excess Thrust vs Weight." },
    { id: "F09", topic: "Formulas", level: "medium", q: "Aspect Ratio:", options: ["Span¬≤ / Area", "Chord", "Thick", "Area"], ans: 0, exp: "Slenderness.", longExp: "b¬≤ / S." },
    { id: "F10", topic: "Formulas", level: "hard", q: "Turn Diameter:", options: ["2 * Radius", "Radius", "V¬≤", "g"], ans: 0, exp: "Geometry.", longExp: "Double the radius." },
  // --- EXPANSION: ADVANCED LIFT & DRAG ---
    { id: "EX01", topic: "Lift", level: "hard", q: "The pressure gradient on the upper surface of a wing is:", options: ["Favorable then Adverse", "Adverse then Favorable", "Constant", "Always Adverse"], ans: 0, exp: "Suction peak to trailing edge.", longExp: "Air accelerates to the suction peak (favorable gradient), then decelerates towards the trailing edge (adverse gradient), promoting separation." },
    { id: "EX02", topic: "Drag", level: "hard", q: "Laminar flow airfoils are designed to:", options: ["Keep the transition point aft", "Move transition forward", "Increase thickness", "Create vortices"], ans: 0, exp: "Reduce skin friction.", longExp: "They delay the transition from laminar to turbulent flow as far back as possible (e.g., 50% chord) to minimize friction drag." },
    { id: "EX03", topic: "Lift", level: "medium", q: "Center of Pressure at stall (cambered wing):", options: ["Moves rapidly aft", "Moves forward", "Stays at 25%", "Moves to tip"], ans: 0, exp: "Loss of suction peak.", longExp: "When the wing stalls, the suction peak at the leading edge collapses, causing the CP to move backwards rapidly. This causes the nose to drop." },
    { id: "EX04", topic: "Drag", level: "medium", q: "Which part of the drag curve is unstable?", options: ["The region below Vmd", "Above Vmd", "High speed", "Cruise"], ans: 0, exp: "Speed instability.", longExp: "Below Vmd (back of the drag curve), slowing down increases drag, which slows you further. You must add power to control speed." },
    { id: "EX05", topic: "Lift", level: "hard", q: "Circulation theory (Magnus effect) explains lift via:", options: ["Rotation superimposed on flow", "Impact pressure", "Drag", "Temperature"], ans: 0, exp: "Kutta-Joukowski.", longExp: "Mathematically, lift is modeled as 'circulation' (vortex strength) around the wing added to the free stream velocity." },
    { id: "EX06", topic: "Atmosphere", level: "medium", q: "The layer containing most weather is:", options: ["Troposphere", "Stratosphere", "Mesosphere", "Thermosphere"], ans: 0, exp: "Lowest layer.", longExp: "75% of the atmosphere's mass and almost all water vapor/weather exist in the Troposphere." },
    { id: "EX07", topic: "Atmosphere", level: "hard", q: "At 18,000 ft, atmospheric pressure is approx:", options: ["50% of MSL", "25%", "75%", "10%"], ans: 0, exp: "Halves every 18k ft.", longExp: "Pressure at 18,000 ft is roughly 500 hPa, half of the sea level pressure." },
    { id: "EX08", topic: "Definitions", level: "easy", q: "Acceleration is:", options: ["Rate of change of velocity", "Speed", "Force", "Energy"], ans: 0, exp: "a = Delta V / t.", longExp: "Acceleration is a vector quantity defined as the rate at which an object changes its velocity." },
    { id: "EX09", topic: "Definitions", level: "medium", q: "Scalar quantities have:", options: ["Magnitude only", "Magnitude and Direction", "Direction only", "Weight"], ans: 0, exp: "e.g., Mass, Temp.", longExp: "Scalars (Mass, Time, Speed) have no direction. Vectors (Force, Velocity, Acceleration) have direction." },
    { id: "EX10", topic: "Basic Aero", level: "hard", q: "Reynolds Number indicates:", options: ["Ratio of Inertial to Viscous forces", "Compressibility", "Speed of sound", "Temp"], ans: 0, exp: "Flow type.", longExp: "High Re = Turbulent (Inertia dominates). Low Re = Laminar (Viscosity dominates)." },

    // --- EXPANSION: STABILITY DEEP DIVE ---
    { id: "EX11", topic: "Stability", level: "hard", q: "The restoring moment in pitch is provided by:", options: ["Tailplane Lift x Lever Arm", "Wing Drag", "Thrust", "Main Wing Lift"], ans: 0, exp: "Moment = F x d.", longExp: "The horizontal stabilizer produces a force (up or down) acting at a distance from the CG (lever arm) to create a stabilizing moment." },
    { id: "EX12", topic: "Stability", level: "medium", q: "Stick fixed stability vs Stick free:", options: ["Stick free is usually lower", "Stick free is higher", "Same", "No relation"], ans: 0, exp: "Floating controls.", longExp: "If controls are free to float with the wind, they may reduce the restoring tendency, making 'Stick Free' stability lower than 'Stick Fixed'." },
    { id: "EX13", topic: "Stability", level: "medium", q: "Sweepback contributes to:", options: ["Lateral and Directional Stability", "Longitudinal only", "Instability", "Stall"], ans: 0, exp: "Restores wings level.", longExp: "In a sideslip, the low wing presents a clearer span to the airflow (more lift), rolling the aircraft level (Lateral Stability)." },
    { id: "EX14", topic: "Stability", level: "hard", q: "A high wing aircraft requires:", options: ["Less Dihedral than a low wing", "More Dihedral", "Anhedral", "No Fin"], ans: 0, exp: "Keel effect.", longExp: "The Keel Effect (pendulum) provides natural lateral stability, so high wing aircraft need less (or zero) geometric dihedral." },
    { id: "EX15", topic: "Stability", level: "medium", q: "Manoeuvre Stability prevents:", options: ["Over-stressing by accidental G-load", "Stall", "Spin", "Overspeed"], ans: 0, exp: "Stick force per G.", longExp: "It ensures that the pilot must pull harder to increase the G-load, giving tactile feedback of the stress on the airframe." },
    { id: "EX16", topic: "Stability", level: "hard", q: "The most forward CG limit is set by:", options: ["Elevator authority for landing flare", "Stability", "Structure", "Stall speed"], ans: 0, exp: "Control power.", longExp: "CG too far forward makes the nose too heavy to raise at low speeds (landing)." },
    { id: "EX17", topic: "Stability", level: "hard", q: "The most aft CG limit is set by:", options: ["Minimum Stability requirement", "Drag", "Range", "Speed"], ans: 0, exp: "Must not be neutral/unstable.", longExp: "CG must remain ahead of the Neutral Point to ensure the aircraft remains statically stable." },
    { id: "EX18", topic: "Stability", level: "medium", q: "Speed Stability means:", options: ["Tendency to return to trimmed speed", "Constant speed", "Auto-throttle", "No flutter"], ans: 0, exp: "Phugoid damping.", longExp: "If speed changes, drag/lift changes create moments that try to return the aircraft to its trimmed airspeed." },
    { id: "EX19", topic: "Stability", level: "hard", q: "Short Period Oscillation:", options: ["Rapid pitch wobble, heavily damped", "Phugoid", "Dutch Roll", "Spiral"], ans: 0, exp: "Deadbeat.", longExp: "A high-frequency pitch oscillation that is usually heavily damped by the tailplane and not noticed by the pilot." },
    { id: "EX20", topic: "Stability", level: "hard", q: "Effect of altitude on damping:", options: ["Damping decreases (less density)", "Damping increases", "No change", "Stops oscillation"], ans: 0, exp: "Thin air.", longExp: "Aerodynamic damping depends on air density. At high altitude, oscillations (like Dutch Roll) are harder to stop." },

    // --- EXPANSION: CONTROL SURFACES & TABS ---
    { id: "EX21", topic: "Controls", level: "medium", q: "Spring Tab at low speed:", options: ["Acts like a rigid link", "Compresses", "Moves opposite", "Locks"], ans: 0, exp: "No assist.", longExp: "At low speeds, air resistance is low, so the spring doesn't compress. The pilot moves the surface directly." },
    { id: "EX22", topic: "Controls", level: "medium", q: "Spring Tab at high speed:", options: ["Spring compresses, tab aids pilot", "Rigid", "Locks", "Flutters"], ans: 0, exp: "Assist.", longExp: "High resistance compresses the spring. The stick moves the tab, and the tab flies the surface." },
    { id: "EX23", topic: "Controls", level: "hard", q: "Purpose of a Downspring:", options: ["Improve stick-free stability", "Reduce force", "Trim", "Balance"], ans: 0, exp: "Pulls stick forward.", longExp: "A spring that pulls the elevator down (stick forward) to ensure the nose drops if speed decreases or stick is released." },
    { id: "EX24", topic: "Controls", level: "medium", q: "Internal Balance (Seal):", options: ["Reduces stick force via pressure", "Mass balance", "Trim", "Drag"], ans: 0, exp: "Beak.", longExp: "A projecting 'beak' inside the wing structure uses air pressure differences to help move the control surface." },
    { id: "EX25", topic: "Controls", level: "hard", q: "Outboard ailerons on jets are locked at speed to:", options: ["Prevent wing twist/reversal", "Save fuel", "Reduce drag", "Prevent stall"], ans: 0, exp: "Aeroelasticity.", longExp: "High forces on outboard ailerons would twist the wing leading edge down, causing the aircraft to roll the wrong way." },
    { id: "EX26", topic: "Controls", level: "medium", q: "Frize Aileron helps:", options: ["Reduce Adverse Yaw", "Increase Lift", "Trim", "Stall"], ans: 0, exp: "Drag on inside wing.", longExp: "The nose of the aileron protrudes into the airflow to create drag on the wing that is going down (inside of turn)." },
    { id: "EX27", topic: "Controls", level: "easy", q: "Primary flight controls:", options: ["Elevator, Aileron, Rudder", "Flaps, Slats", "Trim, Tabs", "Throttle"], ans: 0, exp: "Pitch, Roll, Yaw.", longExp: "The surfaces that control the three axes of rotation." },
    { id: "EX28", topic: "Controls", level: "medium", q: "Secondary flight controls:", options: ["Flaps, Slats, Spoilers, Trim", "Elevator", "Rudder", "Stick"], ans: 0, exp: "Performance/Trim.", longExp: "Devices that change the aircraft's performance or trim state." },
    { id: "EX29", topic: "Controls", level: "hard", q: "Strip theory assumes:", options: ["Each wing section acts independently", "Spanwise flow dominates", "Fuselage lift", "Tip stall"], ans: 0, exp: "Simplification.", longExp: "Calculating lift by treating the wing as many 2D chords. It ignores spanwise flow and interference." },
    { id: "EX30", topic: "Controls", level: "medium", q: "Rudder Limiter:", options: ["Restricts travel at high speed", "Stops stall", "Prevents spin", "Trim"], ans: 0, exp: "Structural protection.", longExp: "Prevents the pilot from over-stressing the vertical fin at high airspeeds." },

    // --- EXPANSION: STALL & SPIN DETAILS ---
    { id: "EX31", topic: "Stalling", level: "hard", q: "The stalling angle of a wing is affected by:", options: ["Planform/Camber (Shape)", "Speed", "Weight", "Density"], ans: 0, exp: "Geometry.", longExp: "Critical Alpha is a geometric property. Speed and Weight change WHEN you reach it, but not the angle itself." },
    { id: "EX32", topic: "Stalling", level: "medium", q: "Rectangular wing stall pattern:", options: ["Root first", "Tip first", "Leading edge", "Trailing edge"], ans: 0, exp: "Safe.", longExp: "Rectangular wings tend to stall at the root first, providing buffet warning and maintaining aileron control." },
    { id: "EX33", topic: "Stalling", level: "hard", q: "Swept wing stall pattern:", options: ["Tip first", "Root first", "Center", "Uniform"], ans: 0, exp: "Dangerous.", longExp: "Swept wings tend to stall at the tips first (due to spanwise flow), causing a pitch-up moment and loss of roll control." },
    { id: "EX34", topic: "Stalling", level: "hard", q: "Tapered wing stall:", options: ["Tip first (unless twisted)", "Root", "Uniform", "None"], ans: 0, exp: "High loading.", longExp: "Highly tapered wings have high local loading at the tips, promoting tip stall." },
    { id: "EX35", topic: "Stalling", level: "medium", q: "Flat Spin:", options: ["Nose high/level, high rotation rate", "Nose down", "Slow rotation", "Spiral"], ans: 0, exp: "Unrecoverable.", longExp: "CG too far aft can cause a flat spin where airflow over the tail is dead, making recovery impossible." },
    { id: "EX36", topic: "Stalling", level: "medium", q: "Spin entry requires:", options: ["Stall + Yaw", "High speed", "Bank", "Power"], ans: 0, exp: "Autorotation.", longExp: "You cannot spin unless you are stalled. Yaw initiates the rotation." },
    { id: "EX37", topic: "Stalling", level: "hard", q: "In a spin, airspeed is:", options: ["Low and fluctuating", "High and increasing", "Zero", "Vne"], ans: 0, exp: "Stalled state.", longExp: "Unlike a spiral dive (speed increases), a spin is a stalled condition, so airspeed is low." },
    { id: "EX38", topic: "Stalling", level: "medium", q: "Effect of flaps on spin:", options: ["Flattens the spin (bad)", "Helps recovery", "Stops spin", "No effect"], ans: 0, exp: "Aft CP.", longExp: "Extending flaps moves mass/drag aft and can make the spin flatter and harder to recover." },
    { id: "EX39", topic: "Stalling", level: "hard", q: "Standard Spin Recovery (PARE):", options: ["Power Idle, Aileron Neutral, Rudder Opposite, Elevator Fwd", "Power Max", "Stick Back", "Rudder With spin"], ans: 0, exp: "The golden rule.", longExp: "Idle (remove torque), Neutral (remove drag/blanking), Opposite Rudder (stop yaw), Stick Forward (unstall)." },
    { id: "EX40", topic: "Stalling", level: "medium", q: "Buffet margin at high altitude:", options: ["Decreases", "Increases", "Constant", "Zero"], ans: 0, exp: "Coffin corner.", longExp: "As you climb, low speed stall increases and high speed shock stall decreases. The margin between them shrinks." },

    // --- EXPANSION: GROUND EFFECT & WAKE ---
    { id: "EX41", topic: "Lift", level: "medium", q: "Leaving Ground Effect causes:", options: ["Increase in Induced Drag, sink", "Decrease in Drag", "Climb", "Pitch up"], ans: 0, exp: "Vortices reform.", longExp: "As you climb out of ground effect, vortices strengthen, Induced Drag increases, and the aircraft may settle/sink." },
    { id: "EX42", topic: "Lift", level: "medium", q: "Entering Ground Effect causes:", options: ["Floating, nose down pitch", "Sink", "Drag increase", "Stall"], ans: 0, exp: "Downwash reduced.", longExp: "Induced drag drops, creating excess thrust. Downwash on tail is reduced, causing effective AoA change on tail (nose down)." },
    { id: "EX43", topic: "Definitions", level: "hard", q: "Wake Turbulence is strongest from:", options: ["Heavy, Clean, Slow", "Heavy, Dirty, Fast", "Light, Slow", "Small"], ans: 0, exp: "High Lift/High Induced Drag.", longExp: "Heavy (High Lift), Clean (Flaps up = Higher Alpha), Slow (High Alpha) produces the strongest vortices." },
    { id: "EX44", topic: "Definitions", level: "medium", q: "Vortex direction:", options: ["Outward, Upward and inward", "Down and Out", "Straight back", "Forward"], ans: 1, exp: "From tip.", longExp: "Vortices circulate from the bottom surface out to the tip and up to the top surface. Behind the wing, they sink and move outward." },
    { id: "EX45", topic: "Definitions", level: "medium", q: "Helicopter Wake:", options: ["Similar to fixed wing when moving", "Downwash only", "None", "Upwash"], ans: 0, exp: "Forward flight.", longExp: "In forward flight, a helicopter rotor disk produces vortices similar to a wing. In hover, it produces massive downwash." },
    
    // --- EXPANSION: PROPS (Basic Aero only) ---
    // (Note: Kept strictly to aero principles, not engine mech)
    { id: "EX46", topic: "Basic Aero", level: "medium", q: "Propeller Twist (Blade Angle):", options: ["High at root, low at tip", "Low at root", "Constant", "None"], ans: 0, exp: "Velocity difference.", longExp: "The tip moves much faster than the root. To maintain a constant Angle of Attack, the blade angle must reduce towards the tip." },
    { id: "EX47", topic: "Basic Aero", level: "hard", q: "Asymmetric Blade Effect (P-Factor):", options: ["Descending blade has higher AoA/Thrust", "Ascending blade has more thrust", "Equal", "Torque"], ans: 0, exp: "High Alpha.", longExp: "At high angles of attack, the descending blade meets the air at a higher relative angle, producing more thrust and causing a yaw (left in CW props)." },
    { id: "EX48", topic: "Basic Aero", level: "medium", q: "Slipstream Effect:", options: ["Spirals around fuselage, hits fin", "Goes straight", "Hits wing", "Drag"], ans: 0, exp: "Yaw left.", longExp: "The corkscrewing slipstream hits the vertical fin on the left side (CW prop), pushing the tail right and nose left." },
    { id: "EX49", topic: "Basic Aero", level: "medium", q: "Torque Effect (Newton):", options: ["Roll opposite to prop rotation", "Yaw", "Pitch", "Drag"], ans: 0, exp: "Action/Reaction.", longExp: "The engine turns the prop one way; the equal and opposite force tries to roll the fuselage the other way." },
    { id: "EX50", topic: "Basic Aero", level: "hard", q: "Gyroscopic Precession (Prop):", options: ["Force applied acts 90 degrees later", "Immediate", "Opposite", "None"], ans: 0, exp: "Tail up = Yaw left.", longExp: "On a taildragger, lifting the tail (force top) results in a force 90 degrees in rotation (right side), causing a left yaw." },

    // --- EXPANSION: FLIGHT LIMITS (Ch10) ---
    { id: "EX51", topic: "Limits", level: "medium", q: "Vno:", options: ["Max Structural Cruising Speed", "Never Exceed", "Manoeuvre", "Flap"], ans: 0, exp: "Green arc.", longExp: "Only fly above Vno in smooth air, and then only with caution. Top of the green arc." },
    { id: "EX52", topic: "Limits", level: "medium", q: "Yellow Arc:", options: ["Caution Range", "Normal", "Flap", "Forbidden"], ans: 0, exp: "Vno to Vne.", longExp: "Smooth air only." },
    { id: "EX53", topic: "Limits", level: "hard", q: "Red Line:", options: ["Vne", "Vno", "Vs", "Va"], ans: 0, exp: "Never Exceed.", longExp: "Maximum speed limit to prevent structural failure or flutter." },
    { id: "EX54", topic: "Limits", level: "hard", q: "Va (Design Manoeuvring Speed):", options: ["Increases with weight", "Decreases with weight", "Constant", "Vne"], ans: 0, exp: "Stall relieves stress.", longExp: "Va is lower at lower weights. At lighter weights, the aircraft accelerates faster (F=ma) and can overstress the airframe before stalling. A higher Va is safe only when heavy." },
    { id: "EX55", topic: "Limits", level: "medium", q: "Load Factor 2.5g limit:", options: ["Typical for Transport Category", "Utility", "Aerobatic", "Fighter"], ans: 0, exp: "Airliners.", longExp: "Large transport aircraft are typically stressed to +2.5g / -1.0g with flaps up." },
    { id: "EX56", topic: "Limits", level: "medium", q: "Utility Category limit:", options: ["4.4g", "3.8g", "2.5g", "6g"], ans: 0, exp: "Semi-acro.", longExp: "Utility category (e.g. Cessna 152/172 without rear passengers) allows up to +4.4g." },
    { id: "EX57", topic: "Limits", level: "medium", q: "Aerobatic Category limit:", options: ["6.0g", "4.4g", "2.5g", "9g"], ans: 0, exp: "Full acro.", longExp: "Certified for +6.0g and -3.0g." },
    { id: "EX58", topic: "Limits", level: "hard", q: "Gust Loads increase with:", options: ["High Speed, Low Wing Loading", "Low Speed", "High Weight", "Altitude"], ans: 0, exp: "Bumpy ride.", longExp: "Flying fast (V) makes gusts hit harder. Low wing loading (large wing, light plane) makes the plane more susceptible to being thrown around." },
    { id: "EX59", topic: "Limits", level: "hard", q: "Vle vs Vlo:", options: ["Vle = Extended, Vlo = Operating", "Same", "Vlo is higher", "Gear up speed"], ans: 0, exp: "Doors.", longExp: "Vlo (Landing Gear Operating) is usually lower than Vle (Extended) because the gear doors are weak while cycling." },
    { id: "EX60", topic: "Limits", level: "medium", q: "Vfe:", options: ["Max Flap Extended speed", "Gear", "Cruise", "Stall"], ans: 0, exp: "Top of white arc.", longExp: "Exceeding this with flaps down can cause structural damage to the flaps or wings." },
    
    // --- FILLER POF QUESTIONS TO REACH 250+ ---
    { id: "F01", topic: "Formulas", level: "medium", q: "Lift/Drag Ratio:", options: ["Efficiency measure", "Power", "Thrust", "Weight"], ans: 0, exp: "L/D.", longExp: "Measure of aerodynamic efficiency." },
    { id: "F02", topic: "Formulas", level: "hard", q: "Total Drag Formula:", options: ["Dp + Di", "L - W", "T - D", "qS"], ans: 0, exp: "Sum.", longExp: "Parasite Drag + Induced Drag." },
    { id: "F03", topic: "Lift", level: "medium", q: "Camber Line:", options: ["Equidistant from surfaces", "Chord", "Flat", "Top"], ans: 0, exp: "Mean.", longExp: "Mean Camber Line." },
    { id: "F04", topic: "Drag", level: "medium", q: "Rivet heads cause:", options: ["Skin Friction", "Induced", "Form", "Wave"], ans: 0, exp: "Roughness.", longExp: "Increases parasite drag." },
    { id: "F05", topic: "Stalling", level: "hard", q: "Stall speed at 1.41g:", options: ["1.19 x Vs", "1.41 x Vs", "2 x Vs", "Same"], ans: 0, exp: "Sqrt(1.41).", longExp: "Sqrt(1.41) = 1.19." },
    { id: "F06", topic: "Stability", level: "medium", q: "Negative Static Stability:", options: ["Diverges instantly", "Oscillates", "Returns", "Neutral"], ans: 0, exp: "Unstable.", longExp: "Move further away from trim." },
    { id: "F07", topic: "Controls", level: "hard", q: "Artificial Feel:", options: ["Q-pot / Spring", "Hydraulic", "Wire", "Tab"], ans: 0, exp: "Simulate load.", longExp: "Required for powered controls." },
    { id: "F08", topic: "Atmosphere", level: "medium", q: "ISA Pressure Lapse:", options: ["1 hPa per 30ft", "100ft", "10ft", "50ft"], ans: 0, exp: "Low level.", longExp: "27-30ft per hPa." },
    { id: "F09", topic: "Lift", level: "hard", q: "Effect of Flaps on AoA:", options: ["Reduces stalling AoA (Geometry)", "Increases", "Same", "Zero"], ans: 0, exp: "Shape change.", longExp: "Flaps change the chord line, effectively reducing the geometric stalling angle." },
    { id: "F10", topic: "Drag", level: "medium", q: "Streamlining reduces:", options: ["Form Drag", "Induced", "Lift", "Weight"], ans: 0, exp: "Shape.", longExp: "Prevents separation." },
    { id: "F11", topic: "Stalling", level: "medium", q: "Power-On Stall:", options: ["Nose high, lower speed", "Higher speed", "Flat", "Easy"], ans: 0, exp: "Prop hang.", longExp: "Thrust component allows lower airspeed." },
    { id: "F12", topic: "Stability", level: "medium", q: "Neutral Stability:", options: ["Stays in new position", "Returns", "Diverges", "Oscillates"], ans: 0, exp: "No tendency.", longExp: "Does not return or diverge." },
    { id: "F13", topic: "Controls", level: "hard", q: "Differential tailplane:", options: ["Roll control + Pitch", "Yaw", "Drag", "Lift"], ans: 0, exp: "Tailerons.", longExp: "Tail moves differentially for roll." },
    { id: "F14", topic: "Lift", level: "hard", q: "Thickness/Chord Ratio:", options: ["Relates to critical Mach", "Lift", "Drag", "Span"], ans: 0, exp: "Speed.", longExp: "Thinner wings for high speed." },
    { id: "F15", topic: "Drag", level: "medium", q: "Dirty configuration:", options: ["Increases Parasite Drag", "Decreases", "No change", "Induced"], ans: 0, exp: "Gear/Flaps.", longExp: "Adds significant form drag." },
    { id: "F16", topic: "Stalling", level: "medium", q: "Canard Stall:", options: ["Foreplane stalls first", "Main wing first", "Together", "Never"], ans: 0, exp: "Safety.", longExp: "Nose drops automatically." },
    { id: "F17", topic: "Stability", level: "hard", q: "Mach Trim:", options: ["Counteracts Mach Tuck", "Speed", "Roll", "Yaw"], ans: 0, exp: "High speed.", longExp: "Auto-trims nose up as CP moves aft." },
    { id: "F18", topic: "Controls", level: "medium", q: "Rudder Yaw:", options: ["Rotation about Vertical Axis", "Lateral", "Longitudinal", "Speed"], ans: 0, exp: "Axis.", longExp: "Z-axis." },
    { id: "F19", topic: "Definitions", level: "easy", q: "Velocity:", options: ["Speed + Direction", "Speed", "Accel", "Mass"], ans: 0, exp: "Vector.", longExp: "Directed speed." },
    { id: "F20", topic: "Atmosphere", level: "hard", q: "Pressure Gradient Force:", options: ["High to Low", "Low to High", "Parallel", "Up"], ans: 0, exp: "Wind driver.", longExp: "Causes wind to blow." }
];

const app={
state:{mode:'practice',pool:[],idx:0,answers:[],used:JSON.parse(localStorage.getItem('ATPL_V20')||"[]")},
init:function(){document.getElementById('dbInfo').innerText=`Loaded: ${DB.length} Questions`},
setM:function(m){
this.state.mode=m;
document.querySelectorAll('.mode-btn').forEach(b=>b.className='mode-btn');
document.getElementById('m-'+m).classList.add('active-'+m);
document.body.className='mode-'+m;
const b=document.getElementById('btnStart');
b.style.backgroundColor=m==='practice'?'var(--primary)':m==='formulas'?'var(--purple)':'var(--orange)';
document.getElementById('dif').style.display=m==='practice'?'block':'none';
},
start:function(){
const cnt=parseInt(document.getElementById('num-sel').value);
const dif=document.getElementById('diff-sel').value;
let c=DB;
if(this.state.mode==='formulas')c=DB.filter(q=>q.topic==='Formulas');
else if(this.state.mode==='practice'){let s=DB.filter(q=>q.level===dif);if(s.length>4)c=s}
c.sort(()=>Math.random()-0.5);
this.state.pool=c.slice(0,cnt);
this.state.answers=new Array(this.state.pool.length).fill(null);
this.state.idx=0;
document.getElementById('view-home').classList.add('hidden');
document.getElementById('view-quiz').classList.remove('hidden');
document.getElementById('nav').classList.remove('hidden');
this.load();
},
load:function(){
const q=this.state.pool[this.state.idx];
const a=this.state.answers[this.state.idx];
document.getElementById('cnt').innerText=`${this.state.idx+1} / ${this.state.pool.length}`;
document.getElementById('qTop').innerText=q.topic;
document.getElementById('qLvl').innerText=q.level.toUpperCase();
document.getElementById('qTxt').innerHTML=q.q;
const b=document.getElementById('opts');b.innerHTML='';
document.getElementById('expl').classList.remove('show');
q.options.forEach((o,i)=>{
const d=document.createElement('div');d.className='option';d.innerHTML=o;
d.onclick=()=>this.ans(i);
if(this.state.mode!=='exam'){
if(a!==null){if(i===q.ans)d.classList.add('correct');else if(i===a)d.classList.add('wrong')}
}else if(a===i)d.classList.add('selected');
b.appendChild(d);
});
if(this.state.mode!=='exam'&&a!==null){
document.getElementById('sh-exp').innerHTML=`<strong>Answer:</strong> ${q.exp}`;
document.getElementById('expl').classList.add('show');
}
const act=document.getElementById('act');
act.innerText=(this.state.idx===this.state.pool.length-1)?(this.state.mode==='exam'?'Submit':'Finish'):'Next';
if(this.state.mode==='exam'&&this.state.idx===this.state.pool.length-1)act.style.backgroundColor='var(--orange)';
},
ans:function(i){
if(this.state.mode!=='exam'&&this.state.answers[this.state.idx]!==null)return;
this.state.answers[this.state.idx]=i;
this.load();
},
deep:function(){
const q=this.state.pool[this.state.idx];
document.getElementById('dp-txt').innerHTML=q.longExp||"No details.";
document.getElementById('mod').classList.add('open');
},
close:function(e){if(!e||e.target===e.currentTarget||e.target.tagName==='BUTTON')document.getElementById('mod').classList.remove('open')},
next:function(){if(this.state.idx<this.state.pool.length-1){this.state.idx++;this.load()}else this.end()},
back:function(){if(this.state.idx>0){this.state.idx--;this.load()}},
end:function(){
if(this.state.mode==='exam'&&!confirm("Submit?"))return;
let c=0;this.state.answers.forEach((a,i)=>{if(a===this.state.pool[i].ans)c++});
const p=Math.round((c/this.state.pool.length)*100);
document.getElementById('view-quiz').classList.add('hidden');
document.getElementById('nav').classList.add('hidden');
document.getElementById('view-res').classList.remove('hidden');
document.getElementById('score').innerText=p+"%";
},
wipe:function(){if(confirm("Reset?")){localStorage.removeItem('ATPL_V20');location.reload()}},
quit:function(){if(confirm("Exit?"))location.reload()}
};
app.init();
</script>
</body>
</html>
