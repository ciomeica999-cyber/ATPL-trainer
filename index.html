<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ATPL MASTER v22</title>
<style>
/* --- THEME v20 (RESTORED) --- */
:root{--primary:#007aff;--orange:#ff9f0a;--purple:#af52de;--bg:#f2f2f7;--card:#ffffff;--text:#000;--sub:#6c6c70;--border:#c6c6c8;--ok:#34c759;--no:#ff3b30;--shadow:0 4px 20px rgba(0,0,0,0.1)}
@media(prefers-color-scheme:dark){:root{--primary:#0a84ff;--bg:#000;--card:#1c1c1e;--text:#fff;--sub:#aeaeb2;--border:#38383a}}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);height:100dvh;display:flex;flex-direction:column;overflow:hidden}
header{height:50px;background:var(--card);border-bottom:0.5px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;font-weight:700;font-size:17px;padding-top:env(safe-area-inset-top);height:calc(50px + env(safe-area-inset-top));z-index:10}
.content{flex:1;overflow-y:auto;padding:20px 20px 150px 20px;-webkit-overflow-scrolling:touch}
.card{background:var(--card);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 2px 10px rgba(0,0,0,0.03)}
.mode-row{display:flex;gap:10px;margin-bottom:15px}
.mode-btn{flex:1;padding:15px;border-radius:12px;background:var(--card);border:2px solid transparent;text-align:center;font-weight:600;font-size:15px;box-shadow:0 2px 5px rgba(0,0,0,0.05);transition:0.2s;cursor:pointer}
.mode-btn.active-practice{border-color:var(--primary);background:rgba(0,122,255,0.1);color:var(--primary)}
.mode-btn.active-formulas{border-color:var(--purple);background:rgba(175,82,222,0.1);color:var(--purple)}
.mode-btn.active-exam{border-color:var(--orange);background:rgba(255,159,10,0.1);color:var(--orange)}
select{width:100%;padding:12px;border-radius:10px;background:var(--bg);color:var(--text);border:1px solid var(--border);margin-bottom:20px;font-size:16px}
.btn-start{width:100%;padding:16px;border-radius:14px;border:none;font-size:17px;font-weight:700;color:#fff;background:var(--primary);cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.2)}
.q-meta{display:flex;justify-content:space-between;font-size:12px;color:var(--sub);margin-bottom:10px;font-weight:600;text-transform:uppercase}
.q-text{font-size:18px;line-height:1.4;margin-bottom:25px;font-weight:600}
.option{width:100%;padding:18px;margin-bottom:12px;background:var(--bg);border:2px solid transparent;border-radius:14px;font-size:16px;color:var(--text);cursor:pointer;position:relative}
.option.correct{background:rgba(52,199,89,0.15);border-color:var(--ok)}
.option.wrong{background:rgba(255,59,48,0.15);border-color:var(--no)}
.option.selected{background:rgba(0,122,255,0.15);border-color:var(--primary)}
body.mode-formulas .option.selected{border-color:var(--purple);background:rgba(175,82,222,0.15)}
body.mode-exam .option.selected{border-color:var(--orange);background:rgba(255,159,10,0.15)}
.explanation{margin-top:20px;padding:15px;background:rgba(255,204,0,0.15);border-radius:12px;font-size:15px;line-height:1.4;border-left:4px solid #ffcc00;display:none}
.explanation.show{display:block}
.btn-deep{background:transparent;border:1px solid var(--text);color:var(--text);padding:8px 15px;border-radius:20px;font-size:13px;font-weight:600;margin-top:10px;cursor:pointer}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(5px);z-index:2000;display:none;align-items:flex-end}
.modal.open{display:flex;animation:up 0.3s ease-out}
.modal-card{background:var(--card);width:100%;max-height:85vh;border-radius:20px 20px 0 0;padding:25px;overflow-y:auto}
.nav{position:fixed;bottom:80px;left:20px;right:20px;height:60px;background:rgba(255,255,255,0.9);backdrop-filter:blur(20px);border-radius:30px;display:flex;align-items:center;padding:5px;box-shadow:var(--shadow);z-index:999;border:1px solid rgba(255,255,255,0.2)}
@media(prefers-color-scheme:dark){.nav{background:rgba(40,40,40,0.85)}}
.nav-btn{width:50px;height:50px;border-radius:25px;border:none;background:0 0;color:var(--text);font-size:20px;font-weight:700;cursor:pointer}
.nav-btn.primary{background:var(--primary);color:#fff;width:auto;flex:1;margin:0 5px;font-size:17px}
.hidden{display:none!important}
@keyframes up{from{transform:translateY(100%)}to{transform:translateY(0)}}
</style>
</head>
<body>
<header><div>ATPL <span style="color:var(--primary)">MASTER</span></div><div id="cnt" style="font-size:14px;color:var(--sub)">Ready</div></header>
<div id="view-home" class="content">
<div class="card">
<h2 style="margin-top:0">Training Setup</h2>
<div style="font-size:13px;color:var(--sub);margin-bottom:20px" id="dbInfo">Loading...</div>
<div class="mode-row"><div class="mode-btn active-practice" id="m-practice" onclick="app.setM('practice')">üéì Practice</div><div class="mode-btn" id="m-formulas" onclick="app.setM('formulas')">üìê Formulas</div></div>
<div class="mode-btn" id="m-exam" onclick="app.setM('exam')" style="margin-bottom:20px">‚è±Ô∏è Exam Mode</div>
<div id="dif"><select id="diff-sel"><option value="easy">Easy</option><option value="medium" selected>Medium</option><option value="hard">Hard</option></select></div>
<select id="num-sel"><option value="10">10 Questions</option><option value="20" selected>20 Questions</option><option value="50">50 Questions</option><option value="100">100 Questions</option></select>
<button class="btn-start" id="btnStart" onclick="app.start()">START SESSION</button>
<div style="text-align:center;margin-top:20px"><a href="#" onclick="app.wipe()" style="color:var(--sub);font-size:12px">Reset Data</a></div>
</div></div>
<div id="view-quiz" class="content hidden">
<div class="card"><div class="q-meta"><span id="qTop"></span><span id="qLvl" style="color:var(--primary)"></span></div>
<div class="q-text" id="qTxt"></div><div id="opts"></div>
<div id="expl" class="explanation"><span id="sh-exp"></span><br><button class="btn-deep" onclick="app.deep()">üìñ Deep Dive</button></div></div></div>
<div id="nav" class="nav hidden"><button class="nav-btn" onclick="app.back()">‚Üê</button><button class="nav-btn primary" id="act" onclick="app.next()">Next</button><button class="nav-btn" onclick="app.quit()">‚úï</button></div>
<div class="modal" id="mod" onclick="app.close(event)"><div class="modal-card"><h2 style="color:var(--primary)">Deep Dive</h2><div id="dp-txt" style="line-height:1.6"></div><button class="btn-start" style="margin-top:20px" onclick="app.close(null)">Close</button></div></div>
<div id="view-res" class="content hidden" style="text-align:center"><div class="card"><h2>Results</h2><div style="font-size:50px;font-weight:800;margin:30px 0;color:var(--primary)" id="score"></div><button class="btn-start" onclick="location.reload()">Home</button></div></div>
<script>
const DB = [
  // =========================
  // ATMOSPHERE / ALTIMETRY
  // =========================
  { id:"A01", topic:"Atmosphere", level:"easy",
    q:"In ISA, the temperature lapse rate in the troposphere is approximately:",
    options:["‚àí2¬∞C per 1,000 ft (‚âà ‚àí6.5¬∞C per km).","‚àí1¬∞C per 1,000 ft.","0¬∞C per 1,000 ft.","‚àí3¬∞C per 1,000 ft."],
    ans:0, exp:"ISA troposphere lapse rate ‚âà ‚àí2¬∞C/1,000 ft.", longExp:"Up to ~11 km (~36,000 ft). Then isothermal in ISA."
  },
  { id:"A02", topic:"Atmosphere", level:"easy",
    q:"QNH set on the altimeter gives approximately:",
    options:["Altitude above mean sea level (AMSL).","Height above airfield elevation.","Pressure altitude.","Density altitude."],
    ans:0, exp:"QNH ‚Üí AMSL.", longExp:"QFE ‚Üí height above airfield; STD 1013.25 ‚Üí pressure altitude."
  },
  { id:"A03", topic:"Atmosphere", level:"medium",
    q:"Flying from HIGH pressure to LOW pressure without changing the altimeter setting, at constant indicated altitude, true altitude will:",
    options:["Decrease.","Increase.","Remain constant.","Increase because the altimeter overreads."],
    ans:0, exp:"High to Low: look out below.", longExp:"Same pressure level becomes physically lower in low-pressure region."
  },
  { id:"A04", topic:"Atmosphere", level:"medium",
    q:"The primary cause of increased density altitude is:",
    options:["Reduced air density compared to ISA at that pressure altitude.","Increased air density compared to ISA.","Higher static pressure at a given altitude.","Lower humidity at a given altitude."],
    ans:0, exp:"Density altitude reflects low density (hot/high/ humid).", longExp:"DA ‚âà PA corrected for temperature (and humidity effect)."
  },
  { id:"A05", topic:"Atmosphere", level:"hard",
    q:"With 1013.25 hPa set, the altimeter reads 4,000 ft on the ground. This indicates the aerodrome:",
    options:["Pressure altitude is 4,000 ft.","Elevation is 4,000 ft AMSL.","QNH is 4,000 ft.","Density altitude is 4,000 ft."],
    ans:0, exp:"STD setting reads pressure altitude.", longExp:"EASA trap: confusing elevation with pressure altitude."
  },
  { id:"A06", topic:"Atmosphere", level:"hard",
    q:"Which condition produces the highest density altitude?",
    options:["High temperature, low pressure, high humidity.","Low temperature, high pressure, dry air.","ISA temperature, high pressure.","Cold and dry air at low altitude."],
    ans:0, exp:"Hot + low pressure + humid = worst density.", longExp:"Humidity reduces density because water vapour is lighter than dry air."
  },
  { id:"A07", topic:"Atmosphere", level:"hard",
    q:"If you fly from an area of LOW temperature to HIGH temperature (same pressure setting, same indicated altitude), your true altitude will generally:",
    options:["Increase.","Decrease.","Remain unchanged.","Become equal to pressure altitude."],
    ans:0, exp:"Cold to Warm: look out below (in cold you are lower).", longExp:"Colder air shrinks pressure levels closer to ground; entering warmer air raises them ‚Üí true altitude increases."
  },
  { id:"A08", topic:"Atmosphere", level:"medium",
    q:"The tropopause in ISA is approximately at:",
    options:["11 km (‚âà 36,000 ft).","5.5 km (‚âà 18,000 ft).","20 km (‚âà 66,000 ft).","8 km (‚âà 26,000 ft)."],
    ans:0, exp:"ISA tropopause ‚âà 11 km.", longExp:"ENAC often pairs this with lapse rate questions."
  },

  // =========================
  // BASIC AERO / PRESSURES
  // =========================
  { id:"BA01", topic:"Basic Aero", level:"easy",
    q:"If local airflow velocity increases over a wing surface (subsonic), local static pressure tends to:",
    options:["Decrease.","Increase.","Remain constant.","Become equal to ambient pressure."],
    ans:0, exp:"Bernoulli trend: higher V ‚Üí lower Ps.", longExp:"EASA trap: confusing static vs total vs dynamic."
  },
  { id:"BA02", topic:"Basic Aero", level:"medium",
    q:"At a stagnation point (subsonic), the flow has:",
    options:["V ‚âà 0 and static pressure maximum (‚âà total).","V maximum and static pressure minimum.","Separation and turbulence only.","Dynamic pressure maximum and static pressure minimum."],
    ans:0, exp:"Stagnation: V‚Üí0, Ps‚âàPt.", longExp:"Pitot measures total (stagnation) pressure."
  },
  { id:"BA03", topic:"Basic Aero", level:"hard",
    q:"At constant IAS during a climb (subsonic), TAS will:",
    options:["Increase.","Decrease.","Remain constant.","Equal ground speed."],
    ans:0, exp:"IAS ~ dynamic pressure; density decreases ‚Üí TAS increases.", longExp:"q=¬ΩœÅV¬≤: if q constant and œÅ‚Üì, V (TAS) ‚Üë."
  },
  { id:"BA04", topic:"Basic Aero", level:"hard",
    q:"The statement 'total pressure is the sum of static and dynamic pressure' is:",
    options:["Correct (in incompressible/subsonic approximation).","Correct only in supersonic flow.","Incorrect because total pressure equals static pressure.","Incorrect because dynamic pressure includes temperature."],
    ans:0, exp:"Pt ‚âà Ps + q for subsonic incompressible.", longExp:"CBT: In compressible flow you use compressibility corrections, but the conceptual relation is still core."
  },
  { id:"BA05", topic:"Basic Aero", level:"medium",
    q:"If the pitot tube is blocked and the drain hole is blocked, IAS will most likely:",
    options:["Act like an altimeter (increase in climb, decrease in descent).","Read zero.","Overread at all speeds.","Remain correct."],
    ans:0, exp:"Trapped total pressure behaves like static system error in altitude changes.", longExp:"Classic pitot-static failure mode question (often in instruments, but used as aero pressure logic)."
  },

  // =========================
  // LIFT / WING THEORY
  // =========================
  { id:"L01", topic:"Lift", level:"easy",
    q:"For a given configuration, an aerodynamic stall occurs at:",
    options:["Critical angle of attack.","A particular indicated airspeed.","A particular pitch attitude.","A fixed Mach number."],
    ans:0, exp:"Stall is AoA-based.", longExp:"Speed/weight/load factor affect AoA required, not critical AoA itself."
  },
  { id:"L02", topic:"Lift", level:"medium",
    q:"The aerodynamic centre (AC) is the point where:",
    options:["Pitching moment coefficient is approximately constant with AoA.","Lift is maximum.","Centre of pressure is fixed for all AoA.","Drag is minimum."],
    ans:0, exp:"AC: Cm ~ constant with AoA.", longExp:"Do not confuse AC with CP (moves) or CG."
  },
  { id:"L03", topic:"Lift", level:"hard",
    q:"On a cambered aerofoil (subsonic), as AoA increases (pre-stall), the centre of pressure generally:",
    options:["Moves forward.","Moves aft.","Remains fixed at 25% chord.","Moves to the tip."],
    ans:0, exp:"CP tends to move forward with AoA on cambered aerofoils.", longExp:"CBT trap: thinking CP is fixed at 25% (that‚Äôs AC-ish)."
  },
  { id:"L04", topic:"Lift", level:"medium",
    q:"Washout (geometric twist) is used mainly to:",
    options:["Ensure root stalls before tip.","Ensure tip stalls before root.","Increase induced drag.","Increase aspect ratio."],
    ans:0, exp:"Root-first stall preserves aileron control.", longExp:"Tip stall risks roll-off and loss of ailerons."
  },
  { id:"L05", topic:"Lift", level:"hard",
    q:"In ground effect (same IAS and configuration), the aircraft tends to float mainly because:",
    options:["Induced drag reduces due to reduced downwash/vortex strength.","Parasite drag increases.","CLmax increases strongly.","Air density increases near the ground."],
    ans:0, exp:"Ground effect reduces induced drag.", longExp:"Lower induced drag ‚Üí less sink, higher effective L/D near ground."
  },
  { id:"L06", topic:"Lift", level:"medium",
    q:"For a symmetrical aerofoil at 0¬∞ AoA (subsonic), lift is approximately:",
    options:["Zero.","Positive.","Negative.","Maximum."],
    ans:0, exp:"No camber ‚Üí CL‚âà0 at 0¬∞.", longExp:"Cambered aerofoils have positive CL at 0¬∞."
  },
  { id:"L07", topic:"Lift", level:"hard",
    q:"A high aspect ratio wing, compared to a low aspect ratio wing, generally has:",
    options:["Lower induced drag for the same lift.","Higher induced drag for the same lift.","Same induced drag but lower parasite drag.","Lower stall speed solely due to AR."],
    ans:0, exp:"High AR reduces induced drag.", longExp:"Stall speed depends on wing loading and CLmax too."
  },
  { id:"L08", topic:"Lift", level:"hard",
    q:"At constant weight and configuration, if IAS is constant in steady flight (ignore compressibility), then lift is approximately:",
    options:["Constant.","Increasing with altitude.","Decreasing with altitude.","Unrelated to IAS."],
    ans:0, exp:"IAS ~ dynamic pressure ‚Üí lift ~ constant for same AoA/CL.", longExp:"ENAC trap: mixing TAS increase with lift increase; IAS is the key for aerodynamic loads."
  },

  // =========================
  // DRAG / PERFORMANCE
  // =========================
  { id:"D01", topic:"Drag", level:"easy",
    q:"Parasite drag varies approximately with:",
    options:["V¬≤.","1/V¬≤.","V.","Constant."],
    ans:0, exp:"Parasite drag ~ V¬≤.", longExp:"Skin friction/form/interference scale with dynamic pressure."
  },
  { id:"D02", topic:"Drag", level:"easy",
    q:"Induced drag varies approximately with:",
    options:["1/V¬≤.","V¬≤.","V.","Constant."],
    ans:0, exp:"Induced drag ~ 1/V¬≤.", longExp:"Low speed requires high CL ‚Üí stronger vortices/downwash."
  },
  { id:"D03", topic:"Drag", level:"medium",
    q:"VMD (minimum drag speed) occurs where:",
    options:["Induced drag equals parasite drag.","Parasite drag is zero.","Lift is maximum.","Thrust required is maximum."],
    ans:0, exp:"At VMD, induced = parasite.", longExp:"Minimum total drag at the intersection of drag components."
  },
  { id:"D04", topic:"Drag", level:"hard",
    q:"Below VMD, if speed decreases slightly in level flight (no power change), the aircraft tends to:",
    options:["Decelerate further unless power is increased.","Return to VMD by itself.","Accelerate because drag decreases.","Climb because induced drag decreases."],
    ans:0, exp:"Back side of the drag/power curve ‚Üí speed unstable.", longExp:"Classic EASA ‚Äòregion of reversed command‚Äô concept."
  },
  { id:"D05", topic:"Drag", level:"hard",
    q:"Interference drag is reduced primarily by:",
    options:["Fairings/fillets at junctions.","Winglets.","Vortex generators.","Increasing camber."],
    ans:0, exp:"Fairings smooth junction flow.", longExp:"Winglets reduce induced drag; VGs delay separation."
  },
  { id:"D06", topic:"Drag", level:"hard",
    q:"If CD = CD0 + kCL¬≤, the maximum L/D occurs at the point where:",
    options:["A straight line from the origin is tangent to the drag polar.","CL is maximum (CLmax).","CD is minimum (CD0).","Thrust equals weight."],
    ans:0, exp:"L/Dmax is the tangent-from-origin point on the polar.", longExp:"CBT killer: they test geometry of drag polar rather than formulas."
  },
  { id:"D07", topic:"Drag", level:"medium",
    q:"For jet aircraft, maximum endurance (min fuel/time) is achieved approximately at:",
    options:["Minimum drag speed (‚âà L/Dmax).","Maximum speed.","Stall speed.","VNE."],
    ans:0, exp:"Jets: endurance ‚âà min drag (best L/D).", longExp:"ENAC trap: props vs jets differ (props: min power for endurance)."
  },

  // =========================
  // STALLING / SPIN / LOAD FACTOR
  // =========================
  { id:"S01", topic:"Stalling", level:"medium",
    q:"A 60¬∞ bank coordinated level turn has a load factor of approximately:",
    options:["2.0","1.5","1.0","3.0"],
    ans:0, exp:"n = 1/cos60 = 2.", longExp:"This drives stall speed increase by ‚àön."
  },
  { id:"S02", topic:"Stalling", level:"hard",
    q:"An aircraft stalls at 60 kt IAS in 1g. In a coordinated level 60¬∞ bank turn, stall speed is approximately:",
    options:["85 kt IAS.","60 kt IAS.","120 kt IAS.","43 kt IAS."],
    ans:0, exp:"VS √ó ‚àö2 ‚âà 1.41 ‚Üí ~85 kt.", longExp:"Classic ENAC/EASA numbers: 60‚Üí85 at 60¬∞ bank."
  },
  { id:"S03", topic:"Stalling", level:"hard",
    q:"Forward CG compared with aft CG generally:",
    options:["Increases stall speed.","Decreases stall speed.","Has no effect on stall speed.","Prevents stall."],
    ans:0, exp:"Forward CG needs more tail downforce ‚Üí wing lifts more.", longExp:"Wing must lift W + tail download ‚Üí higher CL required ‚Üí higher VS."
  },
  { id:"S04", topic:"Stalling", level:"hard",
    q:"Deep stall is most associated with:",
    options:["T-tail aircraft.","Low-wing aircraft.","Canard aircraft.","Rectangular wings."],
    ans:0, exp:"T-tail can be blanketed by stalled wing wake.", longExp:"When tail is in wake, elevator loses authority ‚Üí recovery difficult."
  },
  { id:"S05", topic:"Stalling", level:"hard",
    q:"A spin is best described as:",
    options:["An aggravated stall with autorotation.","A spiral dive.","A steep coordinated turn.","A roll oscillation."],
    ans:0, exp:"Spin = stalled + yaw/autorotation.", longExp:"One wing more stalled ‚Üí yaw/roll couple sustains rotation."
  },
  { id:"S06", topic:"Stalling", level:"hard",
    q:"Standard spin recovery (generic) is closest to:",
    options:["Power idle, ailerons neutral, rudder opposite, ease stick forward.","Full power, stick back.","Ailerons into the spin, rudder with spin.","Hold attitude and wait."],
    ans:0, exp:"PARE logic (Idle/Neutral/Opposite/Forward).", longExp:"Remove yaw and unstall wing; then recover from dive."
  },
  { id:"S07", topic:"Stalling", level:"hard",
    q:"A swept wing is more prone to tip stall primarily due to:",
    options:["Spanwise flow and outboard separation tendency.","Higher induced drag at the tip.","Lower pressure at the root.","Always higher incidence at the tip."],
    ans:0, exp:"Sweep drives spanwise flow ‚Üí tip separation.", longExp:"Devices like fences, twist, and slats manage this."
  },

  // =========================
  // HIGH LIFT DEVICES
  // =========================
  { id:"H01", topic:"High Lift", level:"medium",
    q:"Trailing-edge flaps primarily increase:",
    options:["Camber and CLmax.","Aspect ratio.","Wing sweep.","Mach number."],
    ans:0, exp:"Flaps increase camber ‚Üí CLmax.", longExp:"They also add drag (especially large deflections)."
  },
  { id:"H02", topic:"High Lift", level:"hard",
    q:"Leading edge slats mainly:",
    options:["Delay stall by re-energising the boundary layer via a slot.","Reduce induced drag at cruise.","Increase wing area only.","Move CG forward."],
    ans:0, exp:"Slot effect delays separation at high AoA.", longExp:"High-energy air from below feeds upper surface, keeping it attached."
  },
  { id:"H03", topic:"High Lift", level:"hard",
    q:"A Fowler flap increases lift effectively because it:",
    options:["Increases both wing area and camber.","Only increases camber.","Only increases wing area.","Only creates a slot without changing geometry."],
    ans:0, exp:"Fowler: area‚Üë + camber‚Üë.", longExp:"It‚Äôs among the most effective TE devices for CLmax."
  },
  { id:"H04", topic:"High Lift", level:"hard",
    q:"A split flap is best described as a flap where:",
    options:["Only the lower surface deflects while upper surface remains essentially fixed.","The flap moves back and down.","The flap forms slots through the flap.","The flap can move up as well as down as an aileron."],
    ans:0, exp:"Split flap: lower surface only deflects.", longExp:"CBT trap: confuse split with slotted or Fowler."
  },

  // =========================
  // STABILITY (UP TO HERE)
  // =========================
  { id:"ST01", topic:"Stability", level:"medium",
    q:"Static stability refers to:",
    options:["The initial tendency to return to equilibrium after a disturbance.","The time required to return.","The oscillation frequency only.","Control power."],
    ans:0, exp:"Static = initial tendency.", longExp:"Dynamic stability deals with time history (damping/oscillation)."
  },
  { id:"ST02", topic:"Stability", level:"hard",
    q:"Positive static longitudinal stability requires the CG to be:",
    options:["Ahead of the neutral point.","Behind the neutral point.","At the centre of pressure.","At the wing aerodynamic centre."],
    ans:0, exp:"CG ahead of NP ‚Üí positive static margin.", longExp:"NP is the ‚ÄòAC of the whole aircraft‚Äô."
  },
  { id:"ST03", topic:"Stability", level:"hard",
    q:"If the CG moves aft toward the neutral point, longitudinal stability generally:",
    options:["Decreases.","Increases.","Remains unchanged.","Becomes positive regardless of position."],
    ans:0, exp:"Aft CG reduces static margin.", longExp:"More pitch-sensitive; can approach neutral/negative stability."
  },
  { id:"ST04", topic:"Stability", level:"hard",
    q:"Static margin is the distance between:",
    options:["CG and neutral point (often as %MAC).","CG and centre of pressure.","Wing AC and tail AC.","Mean aerodynamic chord and wingspan."],
    ans:0, exp:"Static margin = NP ‚àí CG.", longExp:"Bigger margin = more stable but heavier handling."
  },
  { id:"ST05", topic:"Stability", level:"hard",
    q:"Spiral divergence is more likely when:",
    options:["Directional stability is strong compared to lateral stability.","Lateral stability is strong compared to directional stability.","Longitudinal stability is negative.","The aircraft is stalled."],
    ans:0, exp:"Too much yaw stability vs dihedral effect ‚Üí bank can tighten.", longExp:"Slow developing: increasing bank, nose down, speed increase."
  },
  { id:"ST06", topic:"Stability", level:"hard",
    q:"Dutch roll is associated with:",
    options:["A yaw-roll oscillation linked to dihedral effect vs directional stability/damping.","A pure pitch oscillation.","A spiral dive.","A fully developed spin."],
    ans:0, exp:"Dutch roll = coupled yaw-roll oscillation.", longExp:"Often on swept wings; yaw damper used."
  },
  { id:"ST07", topic:"Stability", level:"hard",
    q:"A high-wing aircraft generally needs less geometric dihedral mainly because:",
    options:["It benefits from a pendulum/keel effect (CG below wing) in sideslip.","High wings generate more lift.","High wings have less induced drag.","Winglets replace dihedral."],
    ans:0, exp:"High wing + CG below gives lateral stability contribution.", longExp:"ENAC trap: ‚Äòmore lift‚Äô is irrelevant."
  },
  { id:"ST08", topic:"Stability", level:"hard",
    q:"Stick-free longitudinal stability differs from stick-fixed mainly due to:",
    options:["Elevator floating tendency (aerodynamic balance of the elevator).","Control friction only.","Wing sweep.","Rudder effectiveness."],
    ans:0, exp:"Stick-free accounts for elevator floating.", longExp:"Floating can reduce restoring moment compared to stick-fixed."
  },

  // =========================
  // FORMULAS (CBT STYLE)
  // =========================
  { id:"F01", topic:"Formulas", level:"medium",
    q:"Dynamic pressure q is:",
    options:["q = ¬ΩœÅV¬≤","q = œÅV","q = ¬ΩœÅ/V¬≤","q = Ps + Pt"],
    ans:0, exp:"q = ¬ΩœÅV¬≤.", longExp:"Pitot-static: q = Pt ‚àí Ps."
  },
  { id:"F02", topic:"Formulas", level:"hard",
    q:"In a coordinated level turn with bank angle œÜ, load factor n equals:",
    options:["n = 1/cosœÜ","n = cosœÜ","n = tanœÜ","n = 1/tanœÜ"],
    ans:0, exp:"n = 1/cosœÜ.", longExp:"L cosœÜ = W ‚Üí L/W = 1/cosœÜ."
  },
  { id:"F03", topic:"Formulas", level:"hard",
    q:"Stall speed varies with weight as:",
    options:["VS2 = VS1 √ó ‚àö(W2/W1)","VS2 = VS1 √ó (W2/W1)","VS2 = VS1 √ó ‚àö(W1/W2)","VS2 = VS1 √ó (W1/W2)"],
    ans:0, exp:"VS ‚àù ‚àöW.", longExp:"ENAC trap: linear scaling."
  },
  { id:"F04", topic:"Formulas", level:"hard",
    q:"Turn radius R for speed V and bank œÜ is:",
    options:["R = V¬≤/(g tanœÜ)","R = V/(g tanœÜ)","R = g tanœÜ/V","R = V¬≤/(g cosœÜ)"],
    ans:0, exp:"R = V¬≤/(g tanœÜ).", longExp:"Trap: swapping tan and cos or mixing with rate of turn."
  },
  { id:"F05", topic:"Formulas", level:"hard",
    q:"Rate of turn œâ (radians/s) for a coordinated level turn is:",
    options:["œâ = g tanœÜ / V","œâ = V¬≤/(g tanœÜ)","œâ = V/(g tanœÜ)","œâ = g/(V tanœÜ)"],
    ans:0, exp:"œâ = g tanœÜ / V.", longExp:"If asked in deg/s multiply by 57.3."
  },
  { id:"F06", topic:"Formulas", level:"medium",
    q:"Lift coefficient CL is:",
    options:["CL = L/(qS)","CL = L¬∑q¬∑S","CL = q/(LS)","CL = (qS)/L¬≤"],
    ans:0, exp:"CL = L/(qS).", longExp:"CL is dimensionless."
  },
  { id:"F07", topic:"Formulas", level:"hard",
    q:"Hydroplaning speed (dynamic), knots, is commonly approximated by:",
    options:["Vp ‚âà 9‚àö(PSI)","Vp ‚âà 9√óPSI","Vp ‚âà 7√óPSI","Vp ‚âà ‚àö(PSI)/9"],
    ans:0, exp:"Vp ‚âà 9‚àöPSI.", longExp:"Classic ENAC formula."
  },
  { id:"F08", topic:"Formulas", level:"hard",
    q:"Mach number is:",
    options:["M = TAS/a","M = IAS/a","M = GS/a","M = a/TAS"],
    ans:0, exp:"Mach uses TAS over local speed of sound.", longExp:"Local speed of sound mainly depends on temperature."
  },
  { id:"F09", topic:"Formulas", level:"hard",
    q:"Local speed of sound depends primarily on:",
    options:["Static temperature.","Static pressure only.","Density only.","Humidity only."],
    ans:0, exp:"a ‚àù ‚àöT.", longExp:"a = ‚àö(Œ≥RT). Pressure cancels via ideal gas law."
  }
];
// ---------- helpers: stable shuffle per question ----------
function _shuffleInPlace(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function _getOrder(state, q){
  if(!state.orderMap) state.orderMap = {};
  if(state.orderMap[q.id]) return state.orderMap[q.id];
  const order=[0,1,2,3];
  _shuffleInPlace(order);
  state.orderMap[q.id]=order;
  return order;
}
function _dispToOrig(order, dispIdx){ return order[dispIdx]; }
function _origToDisp(order, origIdx){ return order.indexOf(origIdx); }

// ---------- CBT exam config ----------
const CBT_SECONDS_PER_Q = 60; // change to taste (e.g. 75, 90)
const LS_KEY = "ATPL_V22_STATE_CBT"; // session persistence (optional)

const app={
  state:{
    mode:'practice',
    pool:[],
    idx:0,
    answers:[],
    flags:[],
    orderMap:{},
    used:JSON.parse(localStorage.getItem('ATPL_V22')||"[]"),
    // exam session
    startedAt:null,
    timeLeftSec:null,
    timerId:null,
    submitted:false
  },

  // ---------- init UI additions without touching HTML ----------
  init:function(){
    // DB info
    const dbInfo=document.getElementById('dbInfo');
    if(dbInfo) dbInfo.innerText=`Loaded: ${DB.length} Questions`;

    // Make counter clickable to open CBT review grid (only in exam)
    const cnt=document.getElementById('cnt');
    if(cnt){
      cnt.style.cursor="pointer";
      cnt.title="Tap to open Review (Exam Mode)";
      cnt.onclick=()=>this.openReview();
    }

    // Add small timer element in header (right side under/near cnt)
    const header=document.querySelector('header');
    if(header && !document.getElementById('cbtTimer')){
      const t=document.createElement('div');
      t.id="cbtTimer";
      t.style.fontSize="12px";
      t.style.color="var(--sub)";
      t.style.marginLeft="10px";
      t.style.minWidth="70px";
      t.style.textAlign="right";
      // put it next to cnt
      const rightWrap=document.createElement('div');
      rightWrap.style.display="flex";
      rightWrap.style.alignItems="flex-end";
      rightWrap.style.gap="10px";
      // move existing cnt into wrapper
      const cntEl=document.getElementById('cnt');
      cntEl.parentNode.insertBefore(rightWrap, cntEl);
      rightWrap.appendChild(cntEl);
      rightWrap.appendChild(t);
    }

    // Add flag button in nav (between Next and Quit) via JS
    const nav=document.getElementById('nav');
    if(nav && !document.getElementById('btnFlag')){
      const btn=document.createElement('button');
      btn.className="nav-btn";
      btn.id="btnFlag";
      btn.innerText="‚öë";
      btn.title="Flag question (Exam Mode)";
      btn.onclick=()=>this.toggleFlag();
      // nav structure: [Prev][Next][Quit]
      // insert before Quit
      nav.insertBefore(btn, nav.lastElementChild);
    }

    // Create Review modal (grid) via JS (no HTML edits)
    if(!document.getElementById('reviewModal')){
      const m=document.createElement('div');
      m.id="reviewModal";
      m.className="modal";
      m.onclick=(e)=>{ if(e.target===m) this.closeReview(); };
      m.innerHTML=`
        <div class="modal-card">
          <h2 style="color:var(--orange);margin-top:0">Review</h2>
          <div id="reviewMeta" style="color:var(--sub);font-size:13px;margin-bottom:12px"></div>
          <div id="reviewLegend" style="display:flex;gap:10px;flex-wrap:wrap;font-size:12px;color:var(--sub);margin-bottom:12px">
            <span>üüß Current</span><span>‚úÖ Answered</span><span>‚¨ú Unanswered</span><span>‚öë Flagged</span>
          </div>
          <div id="reviewGrid" style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px"></div>
          <button class="btn-start" style="margin-top:18px;background:var(--orange)" onclick="app.closeReview()">Close</button>
        </div>`;
      document.body.appendChild(m);
    }
  },

  // ---------- mode switching ----------
  setM:function(m){
    this.state.mode=m;
    document.querySelectorAll('.mode-btn').forEach(b=>b.className='mode-btn');

    // safeguard: not all have active-xxx class in your CSS for exam/formulas row
    const btn=document.getElementById('m-'+m);
    if(btn){
      btn.classList.add(m==='practice'?'active-practice':m==='formulas'?'active-formulas':'active-exam');
    }
    document.body.className='mode-'+m;

    const startBtn=document.getElementById('btnStart');
    if(startBtn){
      startBtn.style.backgroundColor=m==='practice'?'var(--primary)':m==='formulas'?'var(--purple)':'var(--orange)';
    }
    const dif=document.getElementById('dif');
    if(dif) dif.style.display=(m==='practice')?'block':'none';
  },

  // ---------- start session ----------
  start:function(){
    const cnt=parseInt(document.getElementById('num-sel').value,10);
    const difSel=document.getElementById('diff-sel');
    const dif=difSel?difSel.value:'medium';

    let candidate=DB;

    if(this.state.mode==='formulas'){
      candidate=DB.filter(q=>q.topic==='Formulas');
    } else if(this.state.mode==='practice'){
      const s=DB.filter(q=>q.level===dif);
      if(s.length>=cnt) candidate=s;
    } else if(this.state.mode==='exam'){
      // exam: mixed difficulty by default (more CBT-like)
      candidate=DB.slice();
    }

    candidate = candidate.slice().sort(()=>Math.random()-0.5);
    this.state.pool=candidate.slice(0,cnt);
    this.state.answers=new Array(this.state.pool.length).fill(null); // store ORIGINAL indices
    this.state.flags=new Array(this.state.pool.length).fill(false);
    this.state.idx=0;
    this.state.orderMap={};
    this.state.submitted=false;

    // exam timer setup
    if(this.state.mode==='exam'){
      this.state.startedAt=Date.now();
      this.state.timeLeftSec=this.state.pool.length*CBT_SECONDS_PER_Q;
      this._startTimer();
      this._saveSession();
    } else {
      this._stopTimer();
      this._clearSession();
    }

    document.getElementById('view-home').classList.add('hidden');
    document.getElementById('view-quiz').classList.remove('hidden');
    document.getElementById('nav').classList.remove('hidden');

    this.load();
  },

  // ---------- load question ----------
  load:function(){
    const q=this.state.pool[this.state.idx];
    const a=this.state.answers[this.state.idx];
    const order=_getOrder(this.state, q);

    // header count
    document.getElementById('cnt').innerText=`${this.state.idx+1} / ${this.state.pool.length}`;

    // top meta
    document.getElementById('qTop').innerText=q.topic;
    document.getElementById('qLvl').innerText=(q.level||"").toUpperCase();

    // question text
    document.getElementById('qTxt').innerHTML=q.q;

    // options
    const box=document.getElementById('opts');
    box.innerHTML='';

    // explanation area
    const expl=document.getElementById('expl');
    expl.classList.remove('show');

    for(let dispIdx=0; dispIdx<q.options.length; dispIdx++){
      const origIdx=_dispToOrig(order, dispIdx);
      const optText=q.options[origIdx];

      const d=document.createElement('div');
      d.className='option';
      d.innerHTML=optText;
      d.onclick=()=>this.ans(dispIdx);

      if(this.state.mode==='exam'){
        // CBT: only show selection marker
        if(a!==null && origIdx===a) d.classList.add('selected');
      } else {
        // practice/formulas: show correction after answer
        if(a!==null){
          if(origIdx===q.ans) d.classList.add('correct');
          else if(origIdx===a) d.classList.add('wrong');
        }
      }
      box.appendChild(d);
    }

    // practice/formulas show explanation only after answered
    if(this.state.mode!=='exam' && a!==null){
      document.getElementById('sh-exp').innerHTML=`<strong>Explanation:</strong> ${q.exp || ""}`;
      expl.classList.add('show');
    }

    // deep dive button: hide in exam mode (CBT)
    const deepBtn=expl.querySelector('.btn-deep');
    if(deepBtn) deepBtn.style.display = (this.state.mode==='exam') ? 'none' : 'inline-block';

    // action button text
    const act=document.getElementById('act');
    const last=(this.state.idx===this.state.pool.length-1);
    if(this.state.mode==='exam'){
      act.innerText= last ? 'Submit' : 'Next';
      act.style.backgroundColor = last ? 'var(--orange)' : 'var(--primary)';
    } else {
      act.innerText= last ? 'Finish' : 'Next';
      act.style.backgroundColor = 'var(--primary)';
    }

    // prev button disable feel (optional)
    const prevBtn=document.querySelector('#nav .nav-btn');
    if(prevBtn) prevBtn.style.opacity = (this.state.idx===0) ? 0.5 : 1;

    // flag button state (exam only)
    const f=document.getElementById('btnFlag');
    if(f){
      f.style.display = (this.state.mode==='exam') ? 'inline-flex' : 'none';
      f.style.opacity = this.state.flags[this.state.idx] ? 1 : 0.55;
      f.title = this.state.flags[this.state.idx] ? "Unflag question" : "Flag question";
    }

    // timer visibility
    const timerEl=document.getElementById('cbtTimer');
    if(timerEl){
      timerEl.style.display = (this.state.mode==='exam') ? 'block' : 'none';
      this._renderTimer();
    }

    if(this.state.mode==='exam') this._saveSession();
  },

  // ---------- answer selection ----------
  ans:function(dispIdx){
    const q=this.state.pool[this.state.idx];
    const order=_getOrder(this.state, q);
    const origIdx=_dispToOrig(order, dispIdx);

    // In practice/formulas, lock after first answer
    if(this.state.mode!=='exam' && this.state.answers[this.state.idx]!==null) return;

    this.state.answers[this.state.idx]=origIdx;
    this.load();
  },

  // ---------- navigation ----------
  next:function(){
    if(this.state.idx < this.state.pool.length-1){
      this.state.idx++;
      this.load();
    } else {
      this.end();
    }
  },
  back:function(){
    if(this.state.idx>0){
      this.state.idx--;
      this.load();
    }
  },

  // ---------- deep dive ----------
  deep:function(){
    const q=this.state.pool[this.state.idx];
    document.getElementById('dp-txt').innerHTML = q.longExp || "No details.";
    document.getElementById('mod').classList.add('open');
  },
  close:function(e){
    if(!e || e.target===e.currentTarget || e.target.tagName==='BUTTON'){
      document.getElementById('mod').classList.remove('open');
    }
  },

  // ---------- CBT: flag + review ----------
  toggleFlag:function(){
    if(this.state.mode!=='exam') return;
    this.state.flags[this.state.idx] = !this.state.flags[this.state.idx];
    this.load();
  },

  openReview:function(){
    if(this.state.mode!=='exam') return;
    const m=document.getElementById('reviewModal');
    if(!m) return;

    const total=this.state.pool.length;
    const answered=this.state.answers.filter(x=>x!==null).length;
    const flagged=this.state.flags.filter(Boolean).length;
    const unanswered=total-answered;

    const meta=document.getElementById('reviewMeta');
    meta.innerHTML = `Answered: <strong>${answered}</strong> &nbsp;|&nbsp; Unanswered: <strong>${unanswered}</strong> &nbsp;|&nbsp; Flagged: <strong>${flagged}</strong>`;

    const grid=document.getElementById('reviewGrid');
    grid.innerHTML='';

    for(let i=0;i<total;i++){
      const btn=document.createElement('button');
      btn.className='mode-btn';
      btn.style.padding="12px 0";
      btn.style.borderRadius="12px";
      btn.style.fontWeight="700";
      btn.style.fontSize="14px";
      btn.style.boxShadow="none";

      const isCurrent = (i===this.state.idx);
      const isAnswered = (this.state.answers[i]!==null);
      const isFlagged = (this.state.flags[i]===true);

      // base style
      btn.style.border="2px solid transparent";
      btn.style.background="var(--bg)";
      btn.style.color="var(--text)";

      // decorate
      let label = (i+1).toString();
      if(isFlagged) label = "‚öë " + label;
      btn.innerText = label;

      if(isCurrent){
        btn.style.borderColor="var(--orange)";
        btn.style.background="rgba(255,159,10,0.18)";
      } else if(isAnswered){
        btn.style.borderColor="var(--ok)";
        btn.style.background="rgba(52,199,89,0.14)";
      } else {
        btn.style.borderColor="var(--border)";
        btn.style.background="rgba(255,255,255,0.02)";
        btn.style.opacity="0.9";
      }

      btn.onclick=()=>{
        this.state.idx=i;
        this.closeReview();
        this.load();
      };
      grid.appendChild(btn);
    }

    m.classList.add('open');
  },
  closeReview:function(){
    const m=document.getElementById('reviewModal');
    if(m) m.classList.remove('open');
  },

  // ---------- finish session ----------
  end:function(){
    if(this.state.mode==='exam'){
      const total=this.state.pool.length;
      const answered=this.state.answers.filter(x=>x!==null).length;
      const flagged=this.state.flags.filter(Boolean).length;
      const unanswered=total-answered;

      const msg =
        `Submit exam?\n\n` +
        `Answered: ${answered}/${total}\n` +
        `Unanswered: ${unanswered}\n` +
        `Flagged: ${flagged}\n\n` +
        `Tip: tap the counter (top-right) for Review grid.`;

      if(!confirm(msg)) return;
      this._stopTimer();
      this.state.submitted=true;
      this._clearSession();
    }

    // score
    let correct=0;
    this.state.answers.forEach((a,i)=>{
      if(a===this.state.pool[i].ans) correct++;
    });
    const pct=Math.round((correct/this.state.pool.length)*100);

    // show results
    document.getElementById('view-quiz').classList.add('hidden');
    document.getElementById('nav').classList.add('hidden');
    document.getElementById('view-res').classList.remove('hidden');

    // results text
    document.getElementById('score').innerText=pct+"%";

    // (optional) small coaching: weak topics
    const wrongIdx=[];
    for(let i=0;i<this.state.pool.length;i++){
      if(this.state.answers[i]!==this.state.pool[i].ans) wrongIdx.push(i);
    }
    if(wrongIdx.length){
      const counts={};
      wrongIdx.forEach(i=>{
        const t=this.state.pool[i].topic||"Other";
        counts[t]=(counts[t]||0)+1;
      });
      const sorted=Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,4);
      const card=document.querySelector('#view-res .card');
      let html=`<div style="margin-top:16px;color:var(--sub);font-size:13px;line-height:1.5;text-align:left">
        <strong>Weak areas (review these):</strong><br>${sorted.map(([t,n])=>`‚Ä¢ ${t}: ${n}`).join('<br>')}
      </div>`;
      card.insertAdjacentHTML('beforeend', html);
    }
  },

  // ---------- quit/reset ----------
  wipe:function(){
    if(confirm("Reset?")){
      localStorage.removeItem('ATPL_V22');
      this._clearSession();
      location.reload();
    }
  },
  quit:function(){
    if(this.state.mode==='exam'){
      if(confirm("Exit exam? Progress will be lost.")){
        this._stopTimer();
        this._clearSession();
        location.reload();
      }
    } else {
      if(confirm("Exit?")) location.reload();
    }
  },

  // ---------- timer ----------
  _startTimer:function(){
    this._stopTimer();
    this._renderTimer();
    this.state.timerId=setInterval(()=>{
      if(this.state.mode!=='exam') return;
      if(this.state.timeLeftSec===null) return;
      this.state.timeLeftSec=Math.max(0, this.state.timeLeftSec-1);
      this._renderTimer();
      if(this.state.timeLeftSec<=0){
        this._stopTimer();
        alert("Time is up. Submitting now.");
        this.end();
      }
      this._saveSession();
    },1000);
  },
  _stopTimer:function(){
    if(this.state.timerId){
      clearInterval(this.state.timerId);
      this.state.timerId=null;
    }
  },
  _renderTimer:function(){
    const el=document.getElementById('cbtTimer');
    if(!el || this.state.mode!=='exam') return;
    const s=this.state.timeLeftSec ?? 0;
    const mm=Math.floor(s/60);
    const ss=(s%60).toString().padStart(2,'0');
    el.innerText=`‚è± ${mm}:${ss}`;
  },

  // ---------- session persistence (optional but stabilizes CBT feel) ----------
  _saveSession:function(){
    if(this.state.mode!=='exam') return;
    try{
      const payload={
        mode:this.state.mode,
        idx:this.state.idx,
        poolIds:this.state.pool.map(q=>q.id),
        answers:this.state.answers,
        flags:this.state.flags,
        orderMap:this.state.orderMap,
        timeLeftSec:this.state.timeLeftSec,
        startedAt:this.state.startedAt
      };
      localStorage.setItem(LS_KEY, JSON.stringify(payload));
    }catch(e){}
  },
  _clearSession:function(){
    try{ localStorage.removeItem(LS_KEY); }catch(e){}
  },

  // Call this if you ever want ‚Äúresume exam‚Äù later
  tryResumeExam:function(){
    try{
      const raw=localStorage.getItem(LS_KEY);
      if(!raw) return false;
      const s=JSON.parse(raw);
      if(!s || s.mode!=='exam' || !Array.isArray(s.poolIds)) return false;

      // rebuild pool from DB ids
      const map=new Map(DB.map(q=>[q.id,q]));
      const rebuilt=s.poolIds.map(id=>map.get(id)).filter(Boolean);
      if(rebuilt.length!==s.poolIds.length) return false;

      this.state.mode='exam';
      this.setM('exam');

      this.state.pool=rebuilt;
      this.state.idx=s.idx||0;
      this.state.answers=s.answers||new Array(rebuilt.length).fill(null);
      this.state.flags=s.flags||new Array(rebuilt.length).fill(false);
      this.state.orderMap=s.orderMap||{};
      this.state.timeLeftSec=typeof s.timeLeftSec==='number'?s.timeLeftSec:rebuilt.length*CBT_SECONDS_PER_Q;
      this.state.startedAt=s.startedAt||Date.now();
      this.state.submitted=false;

      document.getElementById('view-home').classList.add('hidden');
      document.getElementById('view-quiz').classList.remove('hidden');
      document.getElementById('nav').classList.remove('hidden');

      this._startTimer();
      this.load();
      return true;
    }catch(e){
      return false;
    }
  }
};

app.init();

// Optional: auto-resume if an exam session exists.
// Uncomment if you want the CBT to reopen where you left it:
// app.tryResumeExam();
</script>
</body>
</html>


